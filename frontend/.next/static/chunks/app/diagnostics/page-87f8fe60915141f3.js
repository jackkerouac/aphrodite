(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[149],{285:(e,s,a)=>{"use strict";a.d(s,{$:()=>d});var t=a(5155);a(2115);var i=a(9708),r=a(2085),l=a(9434);let n=(0,r.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function d(e){let{className:s,variant:a,size:r,asChild:d=!1,...c}=e,o=d?i.DX:"button";return(0,t.jsx)(o,{"data-slot":"button",className:(0,l.cn)(n({variant:a,size:r,className:s})),...c})}},1396:(e,s,a)=>{Promise.resolve().then(a.bind(a,9854))},2523:(e,s,a)=>{"use strict";a.d(s,{p:()=>r});var t=a(5155);a(2115);var i=a(9434);function r(e){let{className:s,type:a,...r}=e;return(0,t.jsx)("input",{type:a,"data-slot":"input",className:(0,i.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",s),...r})}},5057:(e,s,a)=>{"use strict";a.d(s,{J:()=>l});var t=a(5155);a(2115);var i=a(968),r=a(9434);function l(e){let{className:s,...a}=e;return(0,t.jsx)(i.b,{"data-slot":"label",className:(0,r.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",s),...a})}},5365:(e,s,a)=>{"use strict";a.d(s,{Fc:()=>n,TN:()=>c,XL:()=>d});var t=a(5155);a(2115);var i=a(2085),r=a(9434);let l=(0,i.F)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function n(e){let{className:s,variant:a,...i}=e;return(0,t.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,r.cn)(l({variant:a}),s),...i})}function d(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"alert-title",className:(0,r.cn)("col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",s),...a})}function c(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"alert-description",className:(0,r.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",s),...a})}},5690:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(9946).A)("play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]])},6126:(e,s,a)=>{"use strict";a.d(s,{E:()=>d});var t=a(5155);a(2115);var i=a(9708),r=a(2085),l=a(9434);let n=(0,r.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function d(e){let{className:s,variant:a,asChild:r=!1,...d}=e,c=r?i.DX:"span";return(0,t.jsx)(c,{"data-slot":"badge",className:(0,l.cn)(n({variant:a}),s),...d})}},6695:(e,s,a)=>{"use strict";a.d(s,{BT:()=>d,Wu:()=>c,ZB:()=>n,Zp:()=>r,aR:()=>l});var t=a(5155);a(2115);var i=a(9434);function r(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"card",className:(0,i.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",s),...a})}function l(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"card-header",className:(0,i.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",s),...a})}function n(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"card-title",className:(0,i.cn)("leading-none font-semibold",s),...a})}function d(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"card-description",className:(0,i.cn)("text-muted-foreground text-sm",s),...a})}function c(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"card-content",className:(0,i.cn)("px-6",s),...a})}},7313:(e,s,a)=>{"use strict";a.d(s,{Xi:()=>d,av:()=>c,j7:()=>n,tU:()=>l});var t=a(5155);a(2115);var i=a(704),r=a(9434);function l(e){let{className:s,...a}=e;return(0,t.jsx)(i.bL,{"data-slot":"tabs",className:(0,r.cn)("flex flex-col gap-2",s),...a})}function n(e){let{className:s,...a}=e;return(0,t.jsx)(i.B8,{"data-slot":"tabs-list",className:(0,r.cn)("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",s),...a})}function d(e){let{className:s,...a}=e;return(0,t.jsx)(i.l9,{"data-slot":"tabs-trigger",className:(0,r.cn)("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...a})}function c(e){let{className:s,...a}=e;return(0,t.jsx)(i.UC,{"data-slot":"tabs-content",className:(0,r.cn)("flex-1 outline-none",s),...a})}},8979:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(9946).A)("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]])},9434:(e,s,a)=>{"use strict";a.d(s,{cn:()=>r});var t=a(2596),i=a(9688);function r(){for(var e=arguments.length,s=Array(e),a=0;a<e;a++)s[a]=arguments[a];return(0,i.QP)((0,t.$)(s))}},9854:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>y});var t=a(5155),i=a(2115),r=a(6695),l=a(285),n=a(6126),d=a(5365),c=a(7313),o=a(2523),m=a(5057),u=a(1243),x=a(646),h=a(4861),j=a(1154),g=a(3904),f=a(446),p=a(8979),v=a(5690),b=a(1788);function N(){var e;let[s,a]=(0,i.useState)(null),[c,N]=(0,i.useState)(30),[y,w]=(0,i.useState)(null),[_,k]=(0,i.useState)({}),T=async()=>{k(e=>({...e,status:!0}));try{let e=await fetch("/api/v1/batch-debug/status"),s=await e.json();a(s)}catch(e){console.error("Failed to load debug status:",e),a(null)}finally{k(e=>({...e,status:!1}))}},A=async()=>{k(e=>({...e,enable:!0}));try{(await fetch("/api/v1/batch-debug/enable",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({duration_minutes:c})})).ok?await T():console.error("Failed to enable debug mode")}catch(e){console.error("Error enabling debug mode:",e)}finally{k(e=>({...e,enable:!1}))}},C=async()=>{k(e=>({...e,disable:!0}));try{(await fetch("/api/v1/batch-debug/disable",{method:"POST"})).ok?await T():console.error("Failed to disable debug mode")}catch(e){console.error("Error disabling debug mode:",e)}finally{k(e=>({...e,disable:!1}))}},D=async e=>{k(s=>({...s,["summary-".concat(e)]:!0}));try{let s=await fetch("/api/v1/batch-debug/job/".concat(e,"/summary")),a=await s.json();w(a)}catch(s){console.error("Failed to load debug summary for job ".concat(e,":"),s),w({success:!1,error:"Failed to load debug summary"})}finally{k(s=>({...s,["summary-".concat(e)]:!1}))}},B=async(e,s)=>{try{let a=await fetch("/api/v1/batch-debug/job/".concat(e,"/full-log"));if(a.ok){let e=await a.blob(),t=window.URL.createObjectURL(e),i=document.createElement("a");i.href=t,i.download=s,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(t),document.body.removeChild(i)}else console.error("Failed to download debug log")}catch(e){console.error("Error downloading debug log:",e)}},S=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7;k(e=>({...e,cleanup:!0}));try{(await fetch("/api/v1/batch-debug/cleanup?days=".concat(e),{method:"DELETE"})).ok?await T():console.error("Failed to cleanup debug files")}catch(e){console.error("Error cleaning up debug files:",e)}finally{k(e=>({...e,cleanup:!1}))}},E=e=>{if(0===e)return"0 Bytes";let s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]},F=e=>new Date(e).toLocaleString();return(0,i.useEffect)(()=>{T()},[]),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)(r.Zp,{children:[(0,t.jsxs)(r.aR,{children:[(0,t.jsxs)(r.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(f.A,{className:"h-5 w-5"}),"Batch Processing Debug Mode"]}),(0,t.jsx)(r.BT,{children:"Enable comprehensive logging for batch processing jobs to diagnose connection issues"})]}),(0,t.jsxs)(r.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Debug Status"}),(0,t.jsx)("div",{className:"flex items-center gap-2 mt-1",children:(null==s?void 0:s.debug_enabled)?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.E,{variant:"default",className:"bg-green-500",children:[(0,t.jsx)(x.A,{className:"h-3 w-3 mr-1"}),"ENABLED"]}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Debug logging is active for all new batch jobs"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.E,{variant:"secondary",children:[(0,t.jsx)(h.A,{className:"h-3 w-3 mr-1"}),"DISABLED"]}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"No debug logging for batch jobs"})]})})]}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsxs)(l.$,{onClick:T,disabled:_.status,size:"sm",variant:"outline",children:[_.status?(0,t.jsx)(j.A,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)(g.A,{className:"h-4 w-4"}),"Refresh"]})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(m.J,{htmlFor:"debug-duration",children:"Duration (minutes):"}),(0,t.jsx)(o.p,{id:"debug-duration",type:"number",value:c,onChange:e=>N(Number(e.target.value)),min:5,max:120,className:"w-20"})]}),(null==s?void 0:s.debug_enabled)?(0,t.jsxs)(l.$,{onClick:C,disabled:_.disable,variant:"destructive",size:"sm",children:[_.disable?(0,t.jsx)(j.A,{className:"h-4 w-4 animate-spin mr-2"}):(0,t.jsx)(p.A,{className:"h-4 w-4 mr-2"}),"Disable Debug Mode"]}):(0,t.jsxs)(l.$,{onClick:A,disabled:_.enable,size:"sm",children:[_.enable?(0,t.jsx)(j.A,{className:"h-4 w-4 animate-spin mr-2"}):(0,t.jsx)(v.A,{className:"h-4 w-4 mr-2"}),"Enable Debug Mode"]})]}),(0,t.jsxs)(d.Fc,{children:[(0,t.jsx)(u.A,{className:"h-4 w-4"}),(0,t.jsxs)(d.TN,{children:[(0,t.jsx)("strong",{children:"How to use:"}),(0,t.jsx)("br",{}),"1. Enable debug mode before starting batch jobs that are failing",(0,t.jsx)("br",{}),"2. Run your batch job as normal",(0,t.jsx)("br",{}),"3. Review the debug summary and detailed logs below",(0,t.jsx)("br",{}),"4. Debug mode will automatically disable after the specified duration"]})]})]})]}),(0,t.jsxs)(r.Zp,{children:[(0,t.jsxs)(r.aR,{children:[(0,t.jsx)(r.ZB,{children:"Recent Debug Sessions"}),(0,t.jsx)(r.BT,{children:"View and download debug information from recent batch processing jobs"})]}),(0,t.jsxs)(r.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:[(null==s||null==(e=s.recent_debug_files)?void 0:e.length)||0," debug files available"]}),(0,t.jsx)(l.$,{onClick:()=>S(7),disabled:_.cleanup,size:"sm",variant:"outline",children:_.cleanup?(0,t.jsx)(j.A,{className:"h-4 w-4 animate-spin mr-2"}):"Cleanup Old Files"})]}),(null==s?void 0:s.recent_debug_files)&&s.recent_debug_files.length>0?(0,t.jsx)("div",{className:"space-y-3",children:s.recent_debug_files.map((e,s)=>(0,t.jsx)("div",{className:"border rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"font-medium",children:["Job ID: ",e.job_id]}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Created: ",F(e.created_at)," • Size: ",E(e.size_bytes)]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(l.$,{onClick:()=>D(e.job_id),disabled:_["summary-".concat(e.job_id)],size:"sm",variant:"outline",children:_["summary-".concat(e.job_id)]?(0,t.jsx)(j.A,{className:"h-4 w-4 animate-spin"}):"View Summary"}),(0,t.jsxs)(l.$,{onClick:()=>B(e.job_id,e.filename),size:"sm",children:[(0,t.jsx)(b.A,{className:"h-4 w-4 mr-2"}),"Download Full Log"]})]})]})},s))}):(0,t.jsx)("p",{className:"text-center text-muted-foreground py-8",children:"No debug files available. Enable debug mode and run batch jobs to generate debug information."})]})]}),y&&(0,t.jsxs)(r.Zp,{children:[(0,t.jsx)(r.aR,{children:(0,t.jsxs)(r.ZB,{className:"flex items-center gap-2",children:[y.success?(0,t.jsx)(x.A,{className:"h-5 w-5 text-green-500"}):(0,t.jsx)(h.A,{className:"h-5 w-5 text-red-500"}),"Debug Summary",y.debug_summary&&(0,t.jsxs)("span",{className:"text-sm font-normal text-muted-foreground",children:["- Job ",y.debug_summary.job_id]})]})}),(0,t.jsx)(r.Wu,{className:"space-y-4",children:y.error?(0,t.jsx)(d.Fc,{variant:"destructive",children:(0,t.jsx)(d.TN,{children:y.error})}):y.debug_summary?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{className:"text-center p-3 border rounded",children:[(0,t.jsxs)("p",{className:"text-2xl font-bold text-green-600",children:[y.debug_summary.success_rate_percent,"%"]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Success Rate"})]}),(0,t.jsxs)("div",{className:"text-center p-3 border rounded",children:[(0,t.jsx)("p",{className:"text-2xl font-bold",children:y.debug_summary.total_requests}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total Requests"})]}),(0,t.jsxs)("div",{className:"text-center p-3 border rounded",children:[(0,t.jsx)("p",{className:"text-2xl font-bold text-red-600",children:y.debug_summary.failed_requests}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Failed Requests"})]}),(0,t.jsxs)("div",{className:"text-center p-3 border rounded",children:[(0,t.jsxs)("p",{className:"text-2xl font-bold",children:[Math.round(y.debug_summary.duration_seconds),"s"]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Duration"})]})]}),Object.keys(y.debug_summary.status_code_breakdown).length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium mb-2",children:"HTTP Status Codes"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:Object.entries(y.debug_summary.status_code_breakdown).map(e=>{let[s,a]=e;return(0,t.jsxs)(n.E,{variant:s.startsWith("2")?"default":"destructive",children:[s,": ",a]},s)})})]}),y.debug_summary.failure_patterns.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium mb-2",children:"Failure Patterns"}),(0,t.jsx)("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:y.debug_summary.failure_patterns.map((e,s)=>(0,t.jsxs)("div",{className:"border rounded p-3 text-sm",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,t.jsxs)("span",{className:"font-mono",children:[e.poster_id.substring(0,8),"..."]}),(0,t.jsxs)(n.E,{variant:"destructive",children:["HTTP ",e.status_code]})]}),e.error_body&&(0,t.jsx)("p",{className:"text-muted-foreground text-xs",children:e.error_body})]},s))})]}),y.debug_summary.recommendations.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium mb-2",children:"Recommendations"}),(0,t.jsx)("ul",{className:"space-y-1",children:y.debug_summary.recommendations.map((e,s)=>(0,t.jsxs)("li",{className:"text-sm text-muted-foreground flex items-start gap-2",children:[(0,t.jsx)("span",{className:"text-blue-500 mt-1",children:"•"}),(0,t.jsx)("span",{children:e})]},s))})]})]}):null})]})]})}function y(){var e,s,a,f;let[p,v]=(0,i.useState)(null),[b,y]=(0,i.useState)(null),[w,_]=(0,i.useState)([]),[k,T]=(0,i.useState)(null),[A,C]=(0,i.useState)(""),[D,B]=(0,i.useState)([]),[S,E]=(0,i.useState)(null),[F,R]=(0,i.useState)(null),[I,J]=(0,i.useState)(null),[Z,z]=(0,i.useState)(null),[P,W]=(0,i.useState)(null),[U,L]=(0,i.useState)(null),[O,$]=(0,i.useState)({}),M=async(e,s,a)=>{$(s=>({...s,[e]:!0}));try{let e=await fetch("/api/v1/diagnostics/jellyfin/".concat(s)),t=await e.json();a(t)}catch(e){a({success:!1,message:"Failed to run test: ".concat(e instanceof Error?e.message:"Unknown error"),details:{}})}finally{$(s=>({...s,[e]:!1}))}},V=async(e,s,a)=>{$(s=>({...s,[e]:!0}));try{let e=await fetch("/api/v1/diagnostics/infrastructure/".concat(s)),t=await e.json();a(t)}catch(e){a({success:!1,message:"Failed to run test: ".concat(e instanceof Error?e.message:"Unknown error"),details:{}})}finally{$(s=>({...s,[e]:!1}))}},X=async()=>{$(e=>({...e,overview:!0}));try{let e=await fetch("/api/v1/diagnostics/infrastructure/overview"),s=await e.json();R(s)}catch(e){R(null)}finally{$(e=>({...e,overview:!1}))}},q=async()=>{$(e=>({...e,media:!0}));try{let e=await fetch("/api/v1/diagnostics/jellyfin/media-sample"),s=await e.json();_(s)}catch(e){_([])}finally{$(e=>({...e,media:!1}))}},H=async()=>{if(A.trim()){$(e=>({...e,custom:!0}));try{let e=await fetch("/api/v1/diagnostics/jellyfin/test-id/".concat(encodeURIComponent(A.trim())),{method:"POST"}),s=await e.json();T(s)}catch(e){T({success:!1,message:"Failed to test ID: ".concat(e instanceof Error?e.message:"Unknown error"),details:{}})}finally{$(e=>({...e,custom:!1}))}}},Q=async()=>{$(e=>({...e,batch:!0}));try{let e=await fetch("/api/v1/diagnostics/jellyfin/batch-jobs/failed"),s=await e.json();B(s)}catch(e){B([])}finally{$(e=>({...e,batch:!1}))}},G=async e=>{$(s=>({...s,["job-".concat(e)]:!0}));try{let s=await fetch("/api/v1/diagnostics/jellyfin/batch-jobs/".concat(e,"/diagnose"),{method:"POST"}),a=await s.json();E(a)}catch(s){E({success:!1,message:"Failed to diagnose job: ".concat(s instanceof Error?s.message:"Unknown error"),details:{job_info:{id:e,status:"unknown",total_posters:0,completed_posters:0,failed_posters:0,badge_types:[]},tested_poster_ids:[],poster_test_results:[],summary:{total_tested:0,successful:0,failed:0}}})}finally{$(s=>({...s,["job-".concat(e)]:!1}))}},K=e=>null===e?(0,t.jsx)(u.A,{className:"h-4 w-4 text-yellow-500"}):e?(0,t.jsx)(x.A,{className:"h-4 w-4 text-green-500"}):(0,t.jsx)(h.A,{className:"h-4 w-4 text-red-500"}),Y=e=>null===e?(0,t.jsx)(n.E,{variant:"secondary",children:"Unknown"}):e?(0,t.jsx)(n.E,{variant:"default",className:"bg-green-500",children:"Success"}):(0,t.jsx)(n.E,{variant:"destructive",children:"Failed"});return(0,t.jsxs)("div",{className:"container mx-auto p-6 space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Jellyfin Diagnostics"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Diagnose Jellyfin connectivity and data issues"})]}),(0,t.jsxs)(d.Fc,{children:[(0,t.jsx)(u.A,{className:"h-4 w-4"}),(0,t.jsx)(d.TN,{children:"Use these diagnostics to troubleshoot issues with badge processing and Jellyfin connectivity. Common problems include invalid Jellyfin IDs, authentication issues, or configuration problems."})]}),(0,t.jsxs)(c.tU,{defaultValue:"overview",className:"space-y-6",children:[(0,t.jsxs)(c.j7,{className:"grid w-full grid-cols-8",children:[(0,t.jsx)(c.Xi,{value:"overview",children:"Overview"}),(0,t.jsx)(c.Xi,{value:"connection",children:"Connection"}),(0,t.jsx)(c.Xi,{value:"config",children:"Configuration"}),(0,t.jsx)(c.Xi,{value:"infrastructure",children:"Infrastructure"}),(0,t.jsx)(c.Xi,{value:"media",children:"Media Tests"}),(0,t.jsx)(c.Xi,{value:"batch",children:"Batch Jobs"}),(0,t.jsx)(c.Xi,{value:"debug",children:"Batch Debug"}),(0,t.jsx)(c.Xi,{value:"custom",children:"Custom ID Test"})]}),(0,t.jsx)(c.av,{value:"overview",className:"space-y-4",children:(0,t.jsxs)(r.Zp,{children:[(0,t.jsxs)(r.aR,{children:[(0,t.jsx)(r.ZB,{children:"System Overview"}),(0,t.jsx)(r.BT,{children:"Get a high-level view of all infrastructure components"})]}),(0,t.jsxs)(r.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Overall System Status"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:F?"Last checked: ".concat(new Date(F.timestamp).toLocaleString()):"Not checked yet"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[F&&(0,t.jsx)(n.E,{variant:"healthy"===F.overall_status?"default":"destructive",children:F.overall_status.toUpperCase()}),(0,t.jsxs)(l.$,{onClick:X,disabled:O.overview,size:"sm",children:[O.overview?(0,t.jsx)(j.A,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)(g.A,{className:"h-4 w-4"}),"Check All Systems"]})]})]}),F&&(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:F.components.map((e,s)=>{var a;return(0,t.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:["healthy"===e.status?(0,t.jsx)(x.A,{className:"h-4 w-4 text-green-500"}):"degraded"===e.status?(0,t.jsx)(u.A,{className:"h-4 w-4 text-yellow-500"}):(0,t.jsx)(h.A,{className:"h-4 w-4 text-red-500"}),(0,t.jsx)("span",{className:"font-medium",children:e.name})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:e.message}),(null==(a=e.details)?void 0:a.worker_count)&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Workers: ",e.details.worker_count]})]},s)})})]})]})}),(0,t.jsxs)(c.av,{value:"infrastructure",className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)(r.Zp,{children:[(0,t.jsxs)(r.aR,{children:[(0,t.jsxs)(r.ZB,{className:"flex items-center gap-2",children:[K((null==I?void 0:I.success)||null),"Redis Infrastructure"]}),(0,t.jsx)(r.BT,{children:"Test Redis broker and result backend connectivity"})]}),(0,t.jsxs)(r.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Redis Status"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:(null==I?void 0:I.message)||"Not tested yet"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[Y((null==I?void 0:I.success)||null),(0,t.jsxs)(l.$,{onClick:()=>V("redis","redis",J),disabled:O.redis,size:"sm",children:[O.redis?(0,t.jsx)(j.A,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)(g.A,{className:"h-4 w-4"}),"Test Redis"]})]})]}),(null==I?void 0:I.details)&&(0,t.jsxs)("div",{className:"space-y-2 text-sm",children:[I.details.broker&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Broker:"}),(0,t.jsxs)("p",{className:"text-muted-foreground",children:[I.details.broker.ping_successful?"✓ Connected":"✗ Failed",I.details.broker.redis_version&&" (Redis ".concat(I.details.broker.redis_version,")")]})]}),I.details.performance&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Performance:"}),(0,t.jsxs)("p",{className:"text-muted-foreground",children:["Write: ",I.details.performance.write_time_ms,"ms, Read: ",I.details.performance.read_time_ms,"ms"]})]})]})]})]}),(0,t.jsxs)(r.Zp,{children:[(0,t.jsxs)(r.aR,{children:[(0,t.jsxs)(r.ZB,{className:"flex items-center gap-2",children:[K((null==Z?void 0:Z.success)||null),"Celery Workers"]}),(0,t.jsx)(r.BT,{children:"Test Celery worker availability and task registration"})]}),(0,t.jsxs)(r.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Celery Status"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:(null==Z?void 0:Z.message)||"Not tested yet"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[Y((null==Z?void 0:Z.success)||null),(0,t.jsxs)(l.$,{onClick:()=>V("celery","celery",z),disabled:O.celery,size:"sm",children:[O.celery?(0,t.jsx)(j.A,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)(g.A,{className:"h-4 w-4"}),"Test Celery"]})]})]}),(null==Z?void 0:Z.details)&&(0,t.jsxs)("div",{className:"space-y-2 text-sm",children:[Z.details.workers&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Workers:"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:Z.details.workers.workers_available?"".concat(Object.keys(Z.details.workers.active_workers||{}).length," active"):"No workers found"})]}),Z.details.task_registration&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Tasks:"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:Z.details.task_registration.target_task_registered?"✓ Batch task registered":"✗ Batch task missing"})]})]})]})]}),(0,t.jsxs)(r.Zp,{children:[(0,t.jsxs)(r.aR,{children:[(0,t.jsxs)(r.ZB,{className:"flex items-center gap-2",children:[K((null==P?void 0:P.success)||null),"Database"]}),(0,t.jsx)(r.BT,{children:"Test database connectivity and performance"})]}),(0,t.jsxs)(r.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Database Status"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:(null==P?void 0:P.message)||"Not tested yet"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[Y((null==P?void 0:P.success)||null),(0,t.jsxs)(l.$,{onClick:()=>V("database","database",W),disabled:O.database,size:"sm",children:[O.database?(0,t.jsx)(j.A,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)(g.A,{className:"h-4 w-4"}),"Test Database"]})]})]}),(null==P?void 0:P.details)&&(0,t.jsx)("div",{className:"space-y-2 text-sm",children:P.details.performance&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Performance:"}),(0,t.jsxs)("p",{className:"text-muted-foreground",children:["Query time: ",P.details.performance.query_time_ms,"ms"]}),(0,t.jsxs)("p",{className:"text-muted-foreground",children:["Batch jobs: ",P.details.performance.batch_jobs_count]})]})})]})]}),(0,t.jsxs)(r.Zp,{children:[(0,t.jsxs)(r.aR,{children:[(0,t.jsxs)(r.ZB,{className:"flex items-center gap-2",children:[K((null==U?void 0:U.success)||null),"Batch Workflow"]}),(0,t.jsx)(r.BT,{children:"Test complete batch processing workflow"})]}),(0,t.jsxs)(r.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Workflow Status"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:(null==U?void 0:U.message)||"Not tested yet"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[Y((null==U?void 0:U.success)||null),(0,t.jsxs)(l.$,{onClick:()=>{O.workflow||($(e=>({...e,workflow:!0})),fetch("/api/v1/diagnostics/infrastructure/test-batch-workflow",{method:"POST",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>L(e)).catch(e=>L({success:!1,message:"Failed to run test: ".concat(e.message),details:{}})).finally(()=>$(e=>({...e,workflow:!1}))))},disabled:O.workflow,size:"sm",children:[O.workflow?(0,t.jsx)(j.A,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)(g.A,{className:"h-4 w-4"}),"Test Workflow"]})]})]}),(null==U?void 0:U.details)&&(0,t.jsx)("div",{className:"space-y-2 text-sm",children:U.details.summary&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Components:"}),U.details.summary.successful_components.map(e=>(0,t.jsxs)("p",{className:"text-green-600",children:["✓ ",e.replace("_"," ")]},e)),U.details.summary.failed_components.map(e=>(0,t.jsxs)("p",{className:"text-red-600",children:["✗ ",e.replace("_"," ")]},e))]})})]})]})]}),(0,t.jsxs)(d.Fc,{children:[(0,t.jsx)(u.A,{className:"h-4 w-4"}),(0,t.jsxs)(d.TN,{children:[(0,t.jsx)("strong",{children:"Troubleshooting Tips:"}),(0,t.jsx)("br",{}),"• ",(0,t.jsx)("strong",{children:"Redis failures:"})," Check if Redis is running and accessible",(0,t.jsx)("br",{}),"• ",(0,t.jsx)("strong",{children:"Celery failures:"})," Ensure Celery workers are started with correct configuration",(0,t.jsx)("br",{}),"• ",(0,t.jsx)("strong",{children:"Database failures:"})," Verify PostgreSQL is running and connection settings are correct",(0,t.jsx)("br",{}),"• ",(0,t.jsx)("strong",{children:"Workflow failures:"})," Usually indicates a combination of the above issues"]})]})]}),(0,t.jsx)(c.av,{value:"connection",className:"space-y-4",children:(0,t.jsxs)(r.Zp,{children:[(0,t.jsxs)(r.aR,{children:[(0,t.jsxs)(r.ZB,{className:"flex items-center gap-2",children:[K((null==p?void 0:p.success)||null),"Jellyfin Connection Test"]}),(0,t.jsx)(r.BT,{children:"Test basic connectivity to your Jellyfin server"})]}),(0,t.jsxs)(r.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Connection Status"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:(null==p?void 0:p.message)||"Not tested yet"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[Y((null==p?void 0:p.success)||null),(0,t.jsxs)(l.$,{onClick:()=>M("connection","connection",v),disabled:O.connection,size:"sm",children:[O.connection?(0,t.jsx)(j.A,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)(g.A,{className:"h-4 w-4"}),"Test Connection"]})]})]}),(null==p?void 0:p.details)&&(0,t.jsx)("div",{className:"space-y-2",children:p.details.libraries&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"font-medium",children:["Libraries Found: ",p.details.libraries.count]}),null==(e=p.details.libraries.available)?void 0:e.map((e,s)=>(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["• ",e.name," ",e.id?"(ID: ".concat(e.id,")"):"(No ID field)"]},s))]})})]})]})}),(0,t.jsxs)(c.av,{value:"batch",className:"space-y-4",children:[(0,t.jsxs)(r.Zp,{children:[(0,t.jsxs)(r.aR,{children:[(0,t.jsx)(r.ZB,{children:"Failed Batch Jobs Analysis"}),(0,t.jsx)(r.BT,{children:"Analyze recent failed batch jobs to identify poster download issues"})]}),(0,t.jsxs)(r.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:D.length>0?"Found ".concat(D.length," jobs with failures"):"No failed jobs loaded"}),(0,t.jsxs)(l.$,{onClick:Q,disabled:O.batch,size:"sm",children:[O.batch?(0,t.jsx)(j.A,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)(g.A,{className:"h-4 w-4"}),"Load Failed Jobs"]})]}),D.length>0&&(0,t.jsx)("div",{className:"space-y-3",children:D.map(e=>(0,t.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"font-medium",children:["Job ID: ",e.job_id]}),(0,t.jsxs)("div",{className:"flex gap-2 mt-1",children:[(0,t.jsx)(n.E,{variant:"COMPLETED"===e.status?"default":"destructive",children:e.status}),(0,t.jsxs)(n.E,{variant:"outline",children:[e.completed_posters,"/",e.total_posters," completed"]}),e.failed_posters>0&&(0,t.jsxs)(n.E,{variant:"destructive",children:[e.failed_posters," failed"]})]})]}),(0,t.jsx)(l.$,{onClick:()=>G(e.job_id),disabled:O["job-".concat(e.job_id)],size:"sm",children:O["job-".concat(e.job_id)]?(0,t.jsx)(j.A,{className:"h-4 w-4 animate-spin"}):"Diagnose"})]}),e.error_message&&(0,t.jsxs)("p",{className:"text-sm text-red-600 mb-2",children:["Error: ",e.error_message]}),e.sample_failed_ids.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium mb-1",children:"Sample Poster IDs:"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:e.sample_failed_ids.map((e,s)=>(0,t.jsxs)("code",{className:"text-xs bg-gray-100 px-1 rounded",children:[e.substring(0,8),"..."]},s))})]})]},e.job_id))})]})]}),S&&(0,t.jsxs)(r.Zp,{children:[(0,t.jsxs)(r.aR,{children:[(0,t.jsxs)(r.ZB,{className:"flex items-center gap-2",children:[K(S.success),"Batch Job Diagnosis Results"]}),(0,t.jsx)(r.BT,{children:"Detailed analysis of poster download failures"})]}),(0,t.jsxs)(r.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[Y(S.success),(0,t.jsx)("span",{className:"font-medium",children:S.message})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,t.jsxs)("div",{className:"text-center p-3 border rounded",children:[(0,t.jsx)("p",{className:"text-2xl font-bold text-green-600",children:S.details.summary.successful}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Working"})]}),(0,t.jsxs)("div",{className:"text-center p-3 border rounded",children:[(0,t.jsx)("p",{className:"text-2xl font-bold text-red-600",children:S.details.summary.failed}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Failed"})]}),(0,t.jsxs)("div",{className:"text-center p-3 border rounded",children:[(0,t.jsx)("p",{className:"text-2xl font-bold",children:S.details.summary.total_tested}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total Tested"})]})]}),S.details.poster_test_results.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium mb-2",children:"Poster Test Results:"}),(0,t.jsx)("div",{className:"space-y-2",children:S.details.poster_test_results.map((e,s)=>(0,t.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:e.title}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["ID: ",e.jellyfin_id]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(n.E,{variant:e.metadata_available?"default":"destructive",children:e.metadata_available?"Metadata ✓":"Metadata ✗"}),(0,t.jsx)(n.E,{variant:e.poster_available?"default":"destructive",children:e.poster_available?"Poster ✓":"Poster ✗"})]})]}),e.error_message&&(0,t.jsx)("p",{className:"text-sm text-red-600 mt-2",children:e.error_message})]},s))})]}),(0,t.jsxs)(d.Fc,{children:[(0,t.jsx)(u.A,{className:"h-4 w-4"}),(0,t.jsxs)(d.TN,{children:[(0,t.jsx)("strong",{children:"Next Steps:"}),(0,t.jsx)("br",{}),"• If all tests fail: Check Jellyfin configuration and authentication",(0,t.jsx)("br",{}),"• If some tests fail: Verify that these specific poster IDs exist in Jellyfin",(0,t.jsx)("br",{}),"• If tests work but batch jobs fail: Check worker environment differences",(0,t.jsx)("br",{}),"• Use the Custom ID Test tab to test specific failing poster IDs"]})]})]})]})]}),(0,t.jsx)(c.av,{value:"config",className:"space-y-4",children:(0,t.jsxs)(r.Zp,{children:[(0,t.jsxs)(r.aR,{children:[(0,t.jsxs)(r.ZB,{className:"flex items-center gap-2",children:[K((null==b?void 0:b.success)||null),"Jellyfin Configuration Check"]}),(0,t.jsx)(r.BT,{children:"Verify your Jellyfin settings are properly configured"})]}),(0,t.jsxs)(r.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Configuration Status"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:(null==b?void 0:b.message)||"Not checked yet"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[Y((null==b?void 0:b.success)||null),(0,t.jsxs)(l.$,{onClick:()=>M("config","config",y),disabled:O.config,size:"sm",children:[O.config?(0,t.jsx)(j.A,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)(g.A,{className:"h-4 w-4"}),"Check Config"]})]})]}),(null==b?void 0:b.details)&&(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(m.J,{children:"Base URL"}),(0,t.jsx)("p",{className:"text-sm",children:b.details.base_url})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(m.J,{children:"API Key"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("p",{className:"text-sm",children:b.details.api_key}),void 0!==b.details.api_key_valid&&(0,t.jsx)(n.E,{variant:b.details.api_key_valid?"default":"destructive",children:b.details.api_key_valid?"Valid":"Invalid"})]}),b.details.api_key_error&&(0,t.jsx)("p",{className:"text-xs text-red-600",children:b.details.api_key_error}),b.details.connection_message&&(0,t.jsx)("p",{className:"text-xs text-green-600",children:b.details.connection_message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(m.J,{children:"User ID"}),(0,t.jsx)("p",{className:"text-sm",children:b.details.user_id})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(m.J,{children:"User ID Validation"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("p",{className:"text-sm",children:b.details.settings_loaded?"Yes":"No"}),void 0!==b.details.user_id_valid&&(0,t.jsx)(n.E,{variant:b.details.user_id_valid?"default":"destructive",children:b.details.user_id_valid?"Valid":"Invalid"})]}),b.details.user_id_error&&(0,t.jsx)("p",{className:"text-xs text-red-600",children:b.details.user_id_error}),void 0!==b.details.libraries_count&&(0,t.jsxs)("p",{className:"text-xs text-green-600",children:["Found ",b.details.libraries_count," libraries"]})]})]}),(null==b||null==(a=b.details)||null==(s=a.missing_settings)?void 0:s.length)>0&&(0,t.jsx)(d.Fc,{variant:"destructive",children:(0,t.jsxs)(d.TN,{children:["Missing configuration: ",b.details.missing_settings.join(", ")]})})]})]})}),(0,t.jsx)(c.av,{value:"media",className:"space-y-4",children:(0,t.jsxs)(r.Zp,{children:[(0,t.jsxs)(r.aR,{children:[(0,t.jsx)(r.ZB,{children:"Media Item Tests"}),(0,t.jsx)(r.BT,{children:"Test a sample of media items directly from your Jellyfin libraries to check API compatibility"})]}),(0,t.jsxs)(r.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:w.length>0?"Tested ".concat(w.length," items"):"No tests run yet"}),(0,t.jsxs)(l.$,{onClick:q,disabled:O.media,size:"sm",children:[O.media?(0,t.jsx)(j.A,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)(g.A,{className:"h-4 w-4"}),"Test Media Items"]})]}),w.length>0&&(0,t.jsx)("div",{className:"space-y-2",children:w.map((e,s)=>(0,t.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:e.title}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["ID: ",e.jellyfin_id]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(n.E,{variant:e.metadata_available?"default":"destructive",children:e.metadata_available?"Metadata ✓":"Metadata ✗"}),(0,t.jsx)(n.E,{variant:e.poster_available?"default":"destructive",children:e.poster_available?"Poster ✓":"Poster ✗"})]})]}),e.error_message&&(0,t.jsx)("p",{className:"text-sm text-red-600 mt-2",children:e.error_message})]},s))})]})]})}),(0,t.jsx)(c.av,{value:"debug",className:"space-y-4",children:(0,t.jsx)(N,{})}),(0,t.jsxs)(c.av,{value:"custom",className:"space-y-4",children:[(0,t.jsxs)(r.Zp,{children:[(0,t.jsxs)(r.aR,{children:[(0,t.jsx)(r.ZB,{children:"Test Specific Jellyfin ID"}),(0,t.jsx)(r.BT,{children:"Test a specific Jellyfin ID to diagnose issues (useful for debugging failed processing)"})]}),(0,t.jsxs)(r.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)(m.J,{htmlFor:"custom-id",children:"Jellyfin Item ID"}),(0,t.jsx)(o.p,{id:"custom-id",value:A,onChange:e=>C(e.target.value),placeholder:"6ca81413a5022330ba7229693796c553"})]}),(0,t.jsx)("div",{className:"flex items-end",children:(0,t.jsx)(l.$,{onClick:H,disabled:O.custom||!A.trim(),children:O.custom?(0,t.jsx)(j.A,{className:"h-4 w-4 animate-spin"}):"Test ID"})})]}),k&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[K(k.success),(0,t.jsx)("span",{className:"font-medium",children:k.message})]}),(null==(f=k.details)?void 0:f.tests)&&(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Object.entries(k.details.tests).map(e=>{let[s,a]=e;return(0,t.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[K(a.success),(0,t.jsx)("span",{className:"font-medium capitalize",children:s})]}),a.item_name&&(0,t.jsxs)("p",{className:"text-sm",children:["Item: ",a.item_name]}),a.url&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground break-all",children:["URL: ",a.url]}),a.error&&(0,t.jsx)("p",{className:"text-sm text-red-600",children:a.error})]},s)})})]})]})]}),(0,t.jsxs)(d.Fc,{children:[(0,t.jsx)(u.A,{className:"h-4 w-4"}),(0,t.jsxs)(d.TN,{children:[(0,t.jsx)("strong",{children:"Common Issues:"}),(0,t.jsx)("br",{}),"• HTTP 400: Invalid or deleted Jellyfin item ID",(0,t.jsx)("br",{}),"• HTTP 401: Authentication failure (check API key)",(0,t.jsx)("br",{}),"• HTTP 404: Item not found in Jellyfin",(0,t.jsx)("br",{}),"• Network errors: Check Jellyfin URL and connectivity"]})]})]})]})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[455,904,950,441,684,358],()=>s(1396)),_N_E=e.O()}]);