(()=>{var e={};e.id=128,e.ids=[128],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5748:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(62688).A)("minus",[["path",{d:"M5 12h14",key:"1ays0h"}]])},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},13943:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(62688).A)("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]])},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},23385:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(62688).A)("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]])},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31158:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(62688).A)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]])},33873:e=>{"use strict";e.exports=require("path")},35950:(e,s,a)=>{"use strict";a.d(s,{w:()=>n});var t=a(60687);a(43210);var r=a(62369),l=a(4780);function n({className:e,orientation:s="horizontal",decorative:a=!0,...n}){return(0,t.jsx)(r.b,{"data-slot":"separator",decorative:a,orientation:s,className:(0,l.cn)("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",e),...n})}},39759:(e,s,a)=>{"use strict";a.r(s),a.d(s,{GlobalError:()=>n.a,__next_app__:()=>m,pages:()=>d,routeModule:()=>u,tree:()=>o});var t=a(65239),r=a(48088),l=a(88170),n=a.n(l),i=a(30893),c={};for(let e in i)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>i[e]);a.d(s,c);let o={children:["",{children:["poster-manager",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,48028)),"E:\\programming\\aphrodite\\frontend\\src\\app\\poster-manager\\page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(a.bind(a,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(a.bind(a,94431)),"E:\\programming\\aphrodite\\frontend\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(a.t.bind(a,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(a.t.bind(a,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(a.bind(a,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,d=["E:\\programming\\aphrodite\\frontend\\src\\app\\poster-manager\\page.tsx"],m={require:a,loadChunk:()=>Promise.resolve()},u=new t.AppPageRouteModule({definition:{kind:r.RouteKind.APP_PAGE,page:"/poster-manager/page",pathname:"/poster-manager",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},46657:(e,s,a)=>{"use strict";a.d(s,{k:()=>N});var t=a(60687),r=a(43210),l=a(11273),n=a(14163),i="Progress",[c,o]=(0,l.A)(i),[d,m]=c(i),u=r.forwardRef((e,s)=>{var a,r;let{__scopeProgress:l,value:i=null,max:c,getValueLabel:o=p,...m}=e;(c||0===c)&&!f(c)&&console.error((a=`${c}`,`Invalid prop \`max\` of value \`${a}\` supplied to \`Progress\`. Only numbers greater than 0 are valid max values. Defaulting to \`100\`.`));let u=f(c)?c:100;null===i||v(i,u)||console.error((r=`${i}`,`Invalid prop \`value\` of value \`${r}\` supplied to \`Progress\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or 100 if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`));let x=v(i,u)?i:null,h=j(x)?o(x,u):void 0;return(0,t.jsx)(d,{scope:l,value:x,max:u,children:(0,t.jsx)(n.sG.div,{"aria-valuemax":u,"aria-valuemin":0,"aria-valuenow":j(x)?x:void 0,"aria-valuetext":h,role:"progressbar","data-state":g(x,u),"data-value":x??void 0,"data-max":u,...m,ref:s})})});u.displayName=i;var x="ProgressIndicator",h=r.forwardRef((e,s)=>{let{__scopeProgress:a,...r}=e,l=m(x,a);return(0,t.jsx)(n.sG.div,{"data-state":g(l.value,l.max),"data-value":l.value??void 0,"data-max":l.max,...r,ref:s})});function p(e,s){return`${Math.round(e/s*100)}%`}function g(e,s){return null==e?"indeterminate":e===s?"complete":"loading"}function j(e){return"number"==typeof e}function f(e){return j(e)&&!isNaN(e)&&e>0}function v(e,s){return j(e)&&!isNaN(e)&&e<=s&&e>=0}h.displayName=x;var b=a(4780);function N({className:e,value:s,...a}){return(0,t.jsx)(u,{"data-slot":"progress",className:(0,b.cn)("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",e),...a,children:(0,t.jsx)(h,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})})}},48028:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>t});let t=(0,a(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"E:\\\\programming\\\\aphrodite\\\\frontend\\\\src\\\\app\\\\poster-manager\\\\page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"E:\\programming\\aphrodite\\frontend\\src\\app\\poster-manager\\page.tsx","default")},49993:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>eR});var t=a(60687),r=a(43210),l=a(29844),n=a(96834),i=a(15079),c=a(44493),o=a(62688);let d=(0,o.A)("film",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]]),m=(0,o.A)("tv",[["path",{d:"m17 2-5 5-5-5",key:"16satq"}],["rect",{width:"20",height:"15",x:"2",y:"7",rx:"2",key:"1e6viu"}]]),u=(0,o.A)("library",[["path",{d:"m16 6 4 14",key:"ji33uf"}],["path",{d:"M12 6v14",key:"1n7gus"}],["path",{d:"M8 8v12",key:"1gg7y9"}],["path",{d:"M4 4v16",key:"6qkkli"}]]);var x=a(41862);function h({libraries:e,selectedLibrary:s,onLibraryChange:a,loading:r}){let l=e=>{switch(e.toLowerCase()){case"movies":return(0,t.jsx)(d,{className:"h-4 w-4"});case"tvshows":return(0,t.jsx)(m,{className:"h-4 w-4"});default:return(0,t.jsx)(u,{className:"h-4 w-4"})}};return r&&0===e.length?(0,t.jsx)(c.Zp,{children:(0,t.jsxs)(c.Wu,{className:"flex items-center justify-center py-6",children:[(0,t.jsx)(x.A,{className:"h-4 w-4 animate-spin mr-2"}),(0,t.jsx)("span",{children:"Loading libraries..."})]})}):0===e.length?(0,t.jsx)(c.Zp,{children:(0,t.jsxs)(c.Wu,{className:"flex flex-col items-center justify-center py-6",children:[(0,t.jsx)(u,{className:"h-8 w-8 text-muted-foreground mb-2"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"No media libraries found"})]})}):(0,t.jsxs)(c.Zp,{children:[(0,t.jsxs)(c.aR,{children:[(0,t.jsxs)(c.ZB,{className:"flex items-center space-x-2",children:[(0,t.jsx)(u,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"Select Library"})]}),(0,t.jsx)(c.BT,{children:"Choose a Jellyfin library to browse and manage posters"})]}),(0,t.jsx)(c.Wu,{children:(0,t.jsxs)(i.l6,{value:s,onValueChange:a,children:[(0,t.jsx)(i.bq,{children:(0,t.jsx)(i.yv,{placeholder:"Select a library..."})}),(0,t.jsx)(i.gC,{children:e.map(e=>(0,t.jsx)(i.eb,{value:e.id,children:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[l(e.type),(0,t.jsx)("span",{children:e.name}),(0,t.jsx)(n.E,{variant:"outline",children:e.type})]})},e.id))})]})})]})}var p=a(56896);let g=(0,o.A)("image-off",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M10.41 10.41a2 2 0 1 1-2.83-2.83",key:"1bzlo9"}],["line",{x1:"13.5",x2:"6",y1:"13.5",y2:"21",key:"1q0aeu"}],["line",{x1:"18",x2:"21",y1:"12",y2:"15",key:"5mozeu"}],["path",{d:"M3.59 3.59A1.99 1.99 0 0 0 3 5v14a2 2 0 0 0 2 2h14c.55 0 1.052-.22 1.41-.59",key:"mmje98"}],["path",{d:"M21 15V5a2 2 0 0 0-2-2H9",key:"43el77"}]]);var j=a(40228);function f(){let e=process.env.API_URL;return void 0===e||""===e?"":e}function v(e){return!e||e.startsWith("http://")||e.startsWith("https://")?e:e.startsWith("/")?`${f()}${e}`:`${f()}/${e}`}function b({item:e,isSelected:s=!1,onSelectionChange:a,selectionMode:l=!1,onPosterClick:i}){let[o,d]=(0,r.useState)(!1),[m,u]=(0,r.useState)(!0),x=s=>{a&&a(e.id,s)};return(0,t.jsx)(c.Zp,{className:`group hover:shadow-lg transition-all duration-200 ${s?"ring-2 ring-blue-500 bg-blue-50 dark:bg-blue-950":""} ${l?"cursor-pointer hover:ring-2 hover:ring-blue-300":"cursor-pointer"}`,onClick:a=>{l?(a.preventDefault(),x(!s)):i&&i(e)},children:(0,t.jsxs)(c.Wu,{className:"p-0 relative",children:[l&&(0,t.jsx)("div",{className:"absolute top-2 right-2 z-20",children:(0,t.jsx)("div",{className:"bg-white/90 rounded p-1 shadow-sm cursor-pointer",onClick:e=>{e.preventDefault(),e.stopPropagation(),x(!s)},children:(0,t.jsx)(p.S,{checked:s,onCheckedChange:x,className:"pointer-events-none"})})}),(0,t.jsxs)("div",{className:"relative aspect-[2/3] bg-muted rounded-t-lg overflow-hidden",children:[e.poster_url&&!o?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("img",{src:v(e.poster_url),alt:e.title,className:"w-full h-full object-cover transition-transform duration-200 group-hover:scale-105",onLoad:()=>u(!1),onError:()=>{d(!0),u(!1)}},e.poster_url),m&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-muted",children:(0,t.jsx)("div",{className:"animate-pulse",children:(0,t.jsx)(g,{className:"h-8 w-8 text-muted-foreground"})})})]}):(0,t.jsx)("div",{className:"flex items-center justify-center h-full bg-muted",children:(0,t.jsx)(g,{className:"h-12 w-12 text-muted-foreground"})}),(0,t.jsx)("div",{className:"absolute top-2 left-2",children:(0,t.jsx)(n.E,{variant:"BADGED"===e.badge_status?"destructive":"secondary",className:"text-xs",children:e.badge_status})})]}),(0,t.jsxs)("div",{className:"p-3 space-y-2",children:[(0,t.jsx)("h3",{className:"font-medium text-sm line-clamp-2 leading-tight",children:e.title}),e.year&&(0,t.jsxs)("div",{className:"flex items-center text-xs text-muted-foreground",children:[(0,t.jsx)(j.A,{className:"h-3 w-3 mr-1"}),e.year]}),e.genres.length>0&&(0,t.jsxs)("div",{className:"flex flex-wrap gap-1",children:[e.genres.slice(0,2).map(e=>(0,t.jsx)(n.E,{variant:"outline",className:"text-xs px-1 py-0",children:e},e)),e.genres.length>2&&(0,t.jsxs)(n.E,{variant:"outline",className:"text-xs px-1 py-0",children:["+",e.genres.length-2]})]})]})]})})}function N({items:e,loading:s,selectedItems:a=new Set,onSelectionChange:r,selectionMode:l=!1,onPosterClick:n}){return s?(0,t.jsx)(c.Zp,{children:(0,t.jsx)(c.Wu,{className:"flex items-center justify-center py-10",children:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(x.A,{className:"h-6 w-6 animate-spin"}),(0,t.jsx)("span",{children:"Loading posters..."})]})})}):0===e.length?(0,t.jsx)(c.Zp,{children:(0,t.jsxs)(c.Wu,{className:"flex flex-col items-center justify-center py-10",children:[(0,t.jsx)(g,{className:"h-12 w-12 text-muted-foreground mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium mb-2",children:"No items found"}),(0,t.jsx)("p",{className:"text-muted-foreground text-center",children:"Try adjusting your search criteria or filters"})]})}):(0,t.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:e.map(e=>(0,t.jsx)(b,{item:e,isSelected:a.has(e.id),onSelectionChange:r,selectionMode:l,onPosterClick:n},e.id))})}"true"===process.env.DOCKER_ENV||"true"===process.env.IS_DOCKER||process.env.DOCKER_CONTAINER;var y=a(89667),w=a(29523),k=a(99270),_=a(11860);function C({searchQuery:e,onSearchChange:s,badgeFilter:a,onBadgeFilterChange:r,onClearFilters:l}){let n=e||"all"!==a;return(0,t.jsx)(c.Zp,{children:(0,t.jsx)(c.Wu,{className:"p-4",children:(0,t.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(k.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(y.p,{placeholder:"Search by title...",value:e,onChange:e=>s(e.target.value),className:"pl-10"})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-4 items-center",children:[(0,t.jsxs)(i.l6,{value:a,onValueChange:r,children:[(0,t.jsx)(i.bq,{className:"w-[160px]",children:(0,t.jsx)(i.yv,{placeholder:"Badge Status"})}),(0,t.jsxs)(i.gC,{children:[(0,t.jsx)(i.eb,{value:"all",children:"All Items"}),(0,t.jsx)(i.eb,{value:"badged",children:"Badged Only"}),(0,t.jsx)(i.eb,{value:"original",children:"Original Only"})]})]}),n&&(0,t.jsxs)(w.$,{variant:"outline",size:"sm",onClick:l,children:[(0,t.jsx)(_.A,{className:"h-4 w-4 mr-2"}),"Clear"]})]})]})})})}var S=a(45583),$=a(9005),A=a(41312),P=a(78122);let R=(0,o.A)("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]);var E=a(62140),T=a(46657),F=a(93613),M=a(48730);let D=({progress:e,isConnected:s,className:a=""})=>((0,r.useEffect)(()=>{console.log("\uD83D\uDCCA ProgressBar received progress update:",e)},[e]),(0,r.useEffect)(()=>{console.log("\uD83D\uDD17 ProgressBar connection status:",s)},[s]),(0,t.jsxs)("div",{className:`space-y-2 ${a}`,children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(T.k,{value:e.progress_percentage,className:"h-2"}),(0,t.jsx)("div",{className:`absolute top-0 left-0 h-2 rounded transition-all ${!s?"bg-gray-400":e.failed_posters>0?"bg-orange-500":100===e.progress_percentage?"bg-green-500":"bg-blue-500"}`,style:{width:`${e.progress_percentage}%`}})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsxs)("span",{className:"font-medium",children:[e.completed_posters," / ",e.total_posters," completed"]}),e.failed_posters>0&&(0,t.jsxs)(n.E,{variant:"destructive",className:"text-xs",children:[(0,t.jsx)(F.A,{className:"w-3 h-3 mr-1"}),e.failed_posters," failed"]}),(0,t.jsxs)(n.E,{variant:s?"secondary":"outline",className:"text-xs",children:[(0,t.jsx)("div",{className:`w-2 h-2 rounded-full mr-1 ${s?"bg-green-500":"bg-gray-400"}`}),s?"Live":"Disconnected"]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(M.A,{className:"w-4 h-4"}),(0,t.jsxs)("span",{children:["ETA: ",(e=>{if(!e)return"Calculating...";try{return new Date(e).toLocaleTimeString()}catch{return"Unknown"}})(e.estimated_completion)]})]})]}),(0,t.jsx)("div",{className:"text-center",children:(0,t.jsxs)("span",{className:"text-lg font-semibold",children:[e.progress_percentage.toFixed(1),"%"]})})]})),L=(0,o.A)("pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);var z=a(97840),J=a(23385);let I=e=>{let[s,a]=(0,r.useState)({isPausing:!1,isResuming:!1,isCancelling:!1,isRestarting:!1}),t=(0,r.useCallback)(async(s,t)=>{a(e=>({...e,[t]:!0}));try{let a=await fetch(`/api/v1/workflow/control/${e}/${s}`,{method:"POST",headers:{"Content-Type":"application/json"}});if(a.ok)return!0;return console.error(`Failed to ${s} job:`,a.statusText),!1}catch(e){return console.error(`Error ${s}ing job:`,e),!1}finally{a(e=>({...e,[t]:!1}))}},[e]),l=(0,r.useCallback)(()=>t("pause","isPausing"),[t]),n=(0,r.useCallback)(()=>t("resume","isResuming"),[t]),i=(0,r.useCallback)(()=>t("cancel","isCancelling"),[t]),c=(0,r.useCallback)(()=>t("restart","isRestarting"),[t]);return{...s,pauseJob:l,resumeJob:n,cancelJob:i,restartJob:c}},B=({jobId:e,jobStatus:s,onStatusChange:a,disabled:r=!1})=>{let{isPausing:l,isResuming:n,isCancelling:i,isRestarting:c,pauseJob:o,resumeJob:d,cancelJob:m,restartJob:u}=I(e),h=async()=>{await o()&&a&&a("paused")},p=async()=>{await d()&&a&&a("processing")},g=async()=>{await m()&&a&&a("cancelled")},j=async()=>{await u()&&a&&a("queued")},f=l||n||i||c,v="processing"===s,b="paused"===s,N="queued"===s,y=["completed","failed","cancelled"].includes(s);return y?(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Job ",s]}):(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[v&&(0,t.jsx)(w.$,{variant:"outline",size:"sm",onClick:h,disabled:r||f,children:l?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x.A,{className:"w-4 h-4 mr-1 animate-spin"}),"Pausing..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(L,{className:"w-4 h-4 mr-1"}),"Pause"]})}),b&&(0,t.jsx)(w.$,{variant:"outline",size:"sm",onClick:p,disabled:r||f,children:n?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x.A,{className:"w-4 h-4 mr-1 animate-spin"}),"Resuming..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(z.A,{className:"w-4 h-4 mr-1"}),"Resume"]})}),N&&(0,t.jsx)(w.$,{variant:"outline",size:"sm",onClick:j,disabled:r||f,children:c?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x.A,{className:"w-4 h-4 mr-1 animate-spin"}),"Restarting..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(P.A,{className:"w-4 h-4 mr-1"}),"Restart"]})}),!y&&(0,t.jsx)(w.$,{variant:"destructive",size:"sm",onClick:g,disabled:r||f,children:i?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x.A,{className:"w-4 h-4 mr-1 animate-spin"}),"Cancelling..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(J.A,{className:"w-4 h-4 mr-1"}),"Cancel"]})})]})},O=e=>{let[s,a]=(0,r.useState)(null),[t,l]=(0,r.useState)(!1),[n,i]=(0,r.useState)(null),c=(0,r.useRef)(null),o=(0,r.useRef)(null),d=(0,r.useCallback)(()=>{if(!e)return void console.log("❌ No jobId provided to useJobProgress hook");console.log(`🔌 Attempting WebSocket connection for job: ${e}`);try{let s="https:"===window.location.protocol?"wss:":"ws:",t=window.location.host,r=`${s}//${t}/api/v1/workflow/ws/${e}`;console.log(`🔗 Connecting to: ${r}`);let n=new WebSocket(r);c.current=n,n.onopen=()=>{l(!0),i(null),console.log(`✅ WebSocket connected successfully for job ${e}`)},n.onmessage=s=>{console.log(`📨 WebSocket message received for job ${e}:`,s.data);try{let e=JSON.parse(s.data);console.log(`📊 Parsed progress update:`,e),"progress_update"===e.type&&(console.log(`🔄 Setting progress state:`,e.data),a(e.data))}catch(e){console.error("❌ Failed to parse WebSocket message:",e)}},n.onclose=s=>{l(!1),console.log(`🔌 WebSocket disconnected for job ${e}`,s.code,s.reason),a(null),1e3!==s.code&&1001!==s.code&&(console.log(`🔄 Scheduling reconnection for job ${e}`),o.current=setTimeout(()=>{c.current?.readyState===WebSocket.CLOSED&&(console.log(`🔄 Attempting to reconnect WebSocket for job ${e}`),d())},3e3))},n.onerror=s=>{i("WebSocket connection error"),l(!1),console.error(`❌ WebSocket error for job ${e}:`,s)}}catch(s){i("Failed to connect to job progress"),console.error(`❌ WebSocket connection failed for job ${e}:`,s)}},[e]),m=(0,r.useCallback)(()=>{o.current&&(clearTimeout(o.current),o.current=null),c.current&&(c.current.close(),c.current=null),l(!1)},[]),u=(0,r.useCallback)(()=>{m(),d()},[d,m]);return(0,r.useEffect)(()=>(d(),m),[d,m]),{progress:s,isConnected:t,error:n,reconnect:u}},q=({job:e,onJobUpdate:s,onProgressUpdate:a})=>{let[l,i]=(0,r.useState)(e.status),{progress:o,isConnected:d,error:m}=O(e.job_id);(0,r.useEffect)(()=>{console.log(`🎯 JobStatusCard for ${e.job_id}: progress updated:`,o)},[o,e.job_id]),(0,r.useEffect)(()=>{console.log(`🔗 JobStatusCard for ${e.job_id}: connection status:`,d)},[d,e.job_id]),(0,r.useEffect)(()=>{if(o&&a&&d){console.log(`📤 JobStatusCard sending progress update to parent for job ${e.job_id}:`,o);let s=setTimeout(()=>{a(e.job_id,o)},100);return()=>clearTimeout(s)}o&&!d&&console.log(`⚠️ JobStatusCard has progress data but WebSocket disconnected for job ${e.job_id} - not sending stale data`)},[o?.completed_posters,o?.failed_posters,o?.total_posters,e.job_id,a,d]);let u=o||{total_posters:e.total_posters,completed_posters:e.completed_posters,failed_posters:e.failed_posters,progress_percentage:e.total_posters>0?(e.completed_posters+e.failed_posters)/e.total_posters*100:0,estimated_completion:e.estimated_completion};return(0,t.jsxs)(c.Zp,{className:"w-full",children:[(0,t.jsxs)(c.aR,{className:"pb-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(c.ZB,{className:"text-lg",children:e.name}),(0,t.jsx)(n.E,{className:`${(e=>{switch(e){case"completed":return"bg-green-500";case"processing":return"bg-blue-500";case"paused":return"bg-yellow-500";case"failed":return"bg-red-500";case"cancelled":return"bg-gray-500";case"queued":return"bg-purple-500";default:return"bg-gray-400"}})(l)} text-white`,children:l})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-muted-foreground",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(E.A,{className:"w-4 h-4 mr-1"}),e.total_posters," posters"]}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(A.A,{className:"w-4 h-4 mr-1"}),e.badge_types?.join(", ")||"Unknown badges"]}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(j.A,{className:"w-4 h-4 mr-1"}),(e=>{try{return new Date(e).toLocaleString()}catch{return"Unknown"}})(e.created_at)]})]})]}),(0,t.jsxs)(c.Wu,{className:"space-y-4",children:[["processing","paused"].includes(l)&&(0,t.jsx)(D,{progress:u,isConnected:d}),m&&(0,t.jsxs)("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded",children:["Connection error: ",m]}),"completed"===l&&(0,t.jsxs)("div",{className:"text-center text-green-600 font-medium",children:["✅ All ",e.total_posters," posters processed successfully"]}),"failed"===l&&(0,t.jsxs)("div",{className:"text-center text-red-600 font-medium",children:["❌ Job failed - ",e.failed_posters," posters could not be processed"]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["ID: ",e.job_id.slice(0,8),"..."]}),(0,t.jsx)(B,{jobId:e.job_id,jobStatus:l,onStatusChange:a=>{i(a),s?.(e.job_id,a)}})]})]})]})},W=({className:e=""})=>{let[s,a]=(0,r.useState)([]),[l,n]=(0,r.useState)(!0),[o,d]=(0,r.useState)(""),[m,u]=(0,r.useState)("all"),[x,h]=(0,r.useState)(null),p=async()=>{try{n(!0);let e=await fetch("/api/v1/workflow/jobs/");if(e.ok){let s=await e.json();a(s||[]),h(null)}else h("Failed to fetch jobs")}catch(e){h("Network error while fetching jobs"),console.error("Error fetching jobs:",e)}finally{n(!1)}};(0,r.useEffect)(()=>{p()},[]);let g=(e,s)=>{a(a=>a.map(a=>a.job_id===e?{...a,status:s}:a))},j=(0,r.useCallback)((e,s)=>{console.log(`📥 JobsTab received progress update for job ${e}:`,s),a(a=>a.map(a=>a.job_id===e?(console.log(`🔄 JobsTab updating job ${e} with progress data`),{...a,completed_posters:s.completed_posters,failed_posters:s.failed_posters,total_posters:s.total_posters,estimated_completion:s.estimated_completion}):a))},[]),f=s.filter(e=>{let s=e.name.toLowerCase().includes(o.toLowerCase())||e.job_id.toLowerCase().includes(o.toLowerCase()),a="all"===m||e.status===m;return s&&a}),v=(()=>{let e=s.reduce((e,s)=>(e[s.status]=(e[s.status]||0)+1,e),{});return{all:s.length,...e}})();return l?(0,t.jsxs)("div",{className:`flex justify-center items-center h-64 ${e}`,children:[(0,t.jsx)(P.A,{className:"w-8 h-8 animate-spin text-muted-foreground"}),(0,t.jsx)("span",{className:"ml-2 text-muted-foreground",children:"Loading jobs..."})]}):(0,t.jsxs)("div",{className:`space-y-6 ${e}`,children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold",children:"Background Jobs"}),(0,t.jsxs)(w.$,{onClick:p,variant:"outline",size:"sm",children:[(0,t.jsx)(P.A,{className:"w-4 h-4 mr-2"}),"Refresh"]})]}),(0,t.jsxs)(c.Zp,{children:[(0,t.jsx)(c.aR,{children:(0,t.jsx)(c.ZB,{className:"text-lg",children:"Filter Jobs"})}),(0,t.jsx)(c.Wu,{className:"space-y-4",children:(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(k.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,t.jsx)(y.p,{placeholder:"Search by job name or ID...",value:o,onChange:e=>d(e.target.value),className:"pl-10"})]})}),(0,t.jsx)("div",{className:"w-48",children:(0,t.jsxs)(i.l6,{value:m,onValueChange:u,children:[(0,t.jsxs)(i.bq,{children:[(0,t.jsx)(R,{className:"w-4 h-4 mr-2"}),(0,t.jsx)(i.yv,{placeholder:"Filter by status"})]}),(0,t.jsxs)(i.gC,{children:[(0,t.jsxs)(i.eb,{value:"all",children:["All (",v.all,")"]}),(0,t.jsxs)(i.eb,{value:"processing",children:["Processing (",v.processing||0,")"]}),(0,t.jsxs)(i.eb,{value:"paused",children:["Paused (",v.paused||0,")"]}),(0,t.jsxs)(i.eb,{value:"completed",children:["Completed (",v.completed||0,")"]}),(0,t.jsxs)(i.eb,{value:"failed",children:["Failed (",v.failed||0,")"]}),(0,t.jsxs)(i.eb,{value:"cancelled",children:["Cancelled (",v.cancelled||0,")"]}),(0,t.jsxs)(i.eb,{value:"queued",children:["Queued (",v.queued||0,")"]})]})]})})]})})]}),x&&(0,t.jsx)(c.Zp,{className:"border-red-200",children:(0,t.jsx)(c.Wu,{className:"pt-6",children:(0,t.jsx)("div",{className:"text-red-600 text-center",children:x})})}),(0,t.jsx)("div",{className:"space-y-4",children:0===f.length?(0,t.jsx)(c.Zp,{children:(0,t.jsx)(c.Wu,{className:"pt-6",children:(0,t.jsx)("div",{className:"text-center text-muted-foreground",children:0===s.length?"No background jobs found. Create a batch job by selecting 2+ posters in the Poster Manager.":"No jobs match your search criteria."})})}):f.map(e=>(0,t.jsx)(q,{job:e,onJobUpdate:g,onProgressUpdate:j},e.job_id))}),s.length>0&&(0,t.jsx)(c.Zp,{children:(0,t.jsx)(c.Wu,{className:"pt-6",children:(0,t.jsxs)("div",{className:"text-sm text-muted-foreground text-center",children:["Showing ",f.length," of ",s.length," jobs"]})})})]})};var G=a(91821);let Z=({selectedPosters:e,onImmediateProcess:s,onBatchProcess:a,className:r=""})=>{let l=e.length;return 0===l?(0,t.jsx)(G.Fc,{className:r,children:(0,t.jsx)(G.TN,{children:"Select one or more posters to begin badge processing."})}):1===l?(0,t.jsxs)(G.Fc,{className:r,children:[(0,t.jsx)(S.A,{className:"h-4 w-4"}),(0,t.jsxs)(G.TN,{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Immediate Processing"})," - Your poster will be processed instantly with real-time preview."]}),(0,t.jsxs)(n.E,{variant:"secondary",className:"ml-2",children:[(0,t.jsx)(M.A,{className:"w-3 h-3 mr-1"}),"~5-30 seconds"]})]})]}):(0,t.jsxs)(G.Fc,{className:r,children:[(0,t.jsx)(A.A,{className:"h-4 w-4"}),(0,t.jsxs)(G.TN,{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Background Processing"})," - ",l," posters will be processed in the background with real-time progress tracking."]}),(0,t.jsxs)(n.E,{variant:"outline",className:"ml-2",children:[(0,t.jsx)(M.A,{className:"w-3 h-3 mr-1"}),"Track in Jobs tab"]})]})]})};var H=a(54300);let U=({selectedPosters:e,onJobCreated:s,onCancel:a,className:l=""})=>{let[n,i]=(0,r.useState)(`Batch Processing - ${new Date().toLocaleDateString()}`),[o,d]=(0,r.useState)(["audio","resolution"]),[m,u]=(0,r.useState)(!1),[h,g]=(0,r.useState)(null),j=[{id:"audio",label:"Audio Codec Badges",description:"DTS-HD MA, Atmos, etc."},{id:"resolution",label:"Resolution Badges",description:"4K HDR, 1080p, etc."},{id:"review",label:"Review Badges",description:"IMDb, TMDb, RT ratings"},{id:"awards",label:"Awards Badges",description:"Oscars, Emmys, etc."}],f=e=>{d(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},v=async()=>{if(0===o.length)return void g("Please select at least one badge type");u(!0),g(null);try{let a=await fetch("/api/v1/workflow/jobs/batch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n,badge_types:o,poster_ids:e.map(e=>e.id),user_id:"default_user"})});if(a.ok){let e=await a.json();s(e.job_id)}else{let e=await a.json();g(e.detail||"Failed to create batch job")}}catch(e){g("Network error while creating job"),console.error("Error creating batch job:",e)}finally{u(!1)}};return(0,t.jsxs)(c.Zp,{className:l,children:[(0,t.jsx)(c.aR,{children:(0,t.jsxs)(c.ZB,{className:"flex items-center",children:[(0,t.jsx)(E.A,{className:"w-5 h-5 mr-2"}),"Create Batch Processing Job"]})}),(0,t.jsxs)(c.Wu,{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H.J,{htmlFor:"job-name",children:"Job Name"}),(0,t.jsx)(y.p,{id:"job-name",value:n,onChange:e=>i(e.target.value),placeholder:"Enter a descriptive name for this job"})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(H.J,{children:"Badge Types to Apply"}),(0,t.jsx)(w.$,{type:"button",variant:"outline",size:"sm",onClick:()=>{d(j.map(e=>e.id))},className:"text-xs",children:"Select All"})]}),(0,t.jsx)("div",{className:"grid grid-cols-1 gap-3",children:j.map(e=>(0,t.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,t.jsx)(p.S,{id:`badge-${e.id}`,checked:o.includes(e.id),onCheckedChange:()=>f(e.id)}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)(H.J,{htmlFor:`badge-${e.id}`,className:"text-sm font-medium cursor-pointer",children:e.label}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:e.description})]})]},e.id))})]}),(0,t.jsx)(G.Fc,{children:(0,t.jsxs)(G.TN,{children:[(0,t.jsx)("strong",{children:"Job Summary:"})," ",e.length," posters will be processed with ",o.length," badge type",1!==o.length?"s":"",o.length>0&&` (${o.join(", ")})`,"."]})}),h&&(0,t.jsx)(G.Fc,{variant:"destructive",children:(0,t.jsx)(G.TN,{children:h})}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)(w.$,{variant:"outline",onClick:a,disabled:m,children:"Cancel"}),(0,t.jsx)(w.$,{onClick:v,disabled:m||0===o.length,children:m?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x.A,{className:"w-4 h-4 mr-2 animate-spin"}),"Creating Job..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(z.A,{className:"w-4 h-4 mr-2"}),"Start Batch Processing"]})})]})]})]})};var V=a(52581),K=a(5336),X=a(96882);let Q=()=>{let e=(0,r.useCallback)((e,s)=>{V.oR.success((0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)(K.A,{className:"w-4 h-4 text-green-600"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:e}),s&&(0,t.jsx)("div",{className:"text-sm text-muted-foreground mt-1",children:s})]})]}))},[]),s=(0,r.useCallback)((e,s)=>{V.oR.error((0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)(F.A,{className:"w-4 h-4 text-red-600"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:e}),s&&(0,t.jsx)("div",{className:"text-sm text-muted-foreground mt-1",children:s})]})]}),{duration:8e3})},[]),a=(0,r.useCallback)((e,s)=>{V.oR.info((0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)(X.A,{className:"w-4 h-4 text-blue-600"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:e}),s&&(0,t.jsx)("div",{className:"text-sm text-muted-foreground mt-1",children:s})]})]}))},[]),l=(0,r.useCallback)((e,s)=>{V.oR.info((0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)(M.A,{className:"w-4 h-4 text-orange-600"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:e}),s&&(0,t.jsx)("div",{className:"text-sm text-muted-foreground mt-1",children:s})]})]}))},[]),n=(0,r.useCallback)((s,a)=>{e("Background Job Created",`${s} - Processing ${a} posters`)},[e]),i=(0,r.useCallback)((a,t,r=0)=>{0===r?e("Job Completed Successfully",`${a} - All ${t} posters processed`):s("Job Completed with Errors",`${a} - ${t-r}/${t} posters processed, ${r} failed`)},[e,s]),c=(0,r.useCallback)(e=>{a("Job Paused",`${e} has been paused`)},[a]),o=(0,r.useCallback)(e=>{a("Job Resumed",`${e} is now processing`)},[a]),d=(0,r.useCallback)(e=>{s("Job Cancelled",`${e} has been cancelled`)},[s]),m=(0,r.useCallback)(()=>{s("Connection Lost","Lost connection to job progress updates. Trying to reconnect...")},[s]),u=(0,r.useCallback)(()=>{e("Connection Restored","Real-time progress updates are working again")},[e]);return{showSuccess:e,showError:s,showInfo:a,showProgress:l,showJobCreated:n,showJobCompleted:i,showJobPaused:c,showJobResumed:o,showJobCancelled:d,showConnectionError:m,showConnectionRestored:u}};var Y=a(16189),ee=a(63503),es=a(35950),ea=a(35071);let et=[{code:"en",name:"English",native_name:"English"},{code:"ar",name:"Arabic",native_name:"العربية"},{code:"zh",name:"Chinese",native_name:"中文"},{code:"cs",name:"Czech",native_name:"Čeština"},{code:"da",name:"Danish",native_name:"Dansk"},{code:"nl",name:"Dutch",native_name:"Nederlands"},{code:"fi",name:"Finnish",native_name:"Suomi"},{code:"fr",name:"French",native_name:"Fran\xe7ais"},{code:"de",name:"German",native_name:"Deutsch"},{code:"he",name:"Hebrew",native_name:"עברית"},{code:"hu",name:"Hungarian",native_name:"Magyar"},{code:"it",name:"Italian",native_name:"Italiano"},{code:"ja",name:"Japanese",native_name:"日本語"},{code:"ko",name:"Korean",native_name:"한국어"},{code:"no",name:"Norwegian",native_name:"Norsk"},{code:"pl",name:"Polish",native_name:"Polski"},{code:"pt",name:"Portuguese",native_name:"Portugu\xeas"},{code:"ru",name:"Russian",native_name:"Русский"},{code:"es",name:"Spanish",native_name:"Espa\xf1ol"},{code:"sv",name:"Swedish",native_name:"Svenska"},{code:"tr",name:"Turkish",native_name:"T\xfcrk\xe7e"},{code:"null",name:"No Language (Textless)",native_name:"Textless"}],er=({value:e,onValueChange:s,disabled:a=!1,label:r="Language Preference",placeholder:l="Select language...",className:n=""})=>(0,t.jsxs)("div",{className:`space-y-2 ${n}`,children:[r&&(0,t.jsx)(H.J,{htmlFor:"language-selector",children:r}),(0,t.jsxs)(i.l6,{value:e,onValueChange:s,disabled:a,children:[(0,t.jsx)(i.bq,{id:"language-selector",children:(0,t.jsx)(i.yv,{placeholder:l})}),(0,t.jsx)(i.gC,{children:et.map(e=>(0,t.jsx)(i.eb,{value:e.code,children:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("span",{children:e.name}),(0,t.jsxs)("span",{className:"text-muted-foreground",children:["(",e.native_name,")"]})]})},e.code))})]})]}),el=({open:e,onOpenChange:s,selectedItems:a,onSuccess:l})=>{let[n,i]=(0,r.useState)("en"),[c,o]=(0,r.useState)(!1),[d,m]=(0,r.useState)(null),[u,h]=(0,r.useState)("setup"),p=async()=>{o(!0),h("processing");try{let e=await fetch("/api/v1/poster-replacement/bulk-replace-posters",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({item_ids:a.map(e=>e.id),jellyfin_ids:a.map(e=>e.id),language_preference:n,random_selection:!0})});if(!e.ok){let s=await e.json();throw Error(s.detail||"Failed to replace posters")}let s=await e.json();m(s),h("results"),s.successful_replacements>0&&(V.oR.success(`Successfully replaced ${s.successful_replacements} poster${1!==s.successful_replacements?"s":""}`),l())}catch(e){console.error("Error replacing posters:",e),V.oR.error(e instanceof Error?e.message:"Failed to replace posters"),h("setup")}finally{o(!1)}},g=()=>{c||(s(!1),setTimeout(()=>{h("setup"),m(null),i("en")},300))};return(0,t.jsx)(ee.lG,{open:e,onOpenChange:g,children:(0,t.jsxs)(ee.Cf,{className:"sm:max-w-md",children:[(0,t.jsxs)(ee.c7,{children:[(0,t.jsx)(ee.L3,{children:"Bulk Poster Replacement"}),(0,t.jsx)(ee.rr,{children:"Replace multiple posters with alternatives from external sources"})]}),"setup"===u&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"text-center space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,t.jsx)($.A,{className:"h-5 w-5 text-blue-600"}),(0,t.jsxs)("span",{className:"text-lg font-medium",children:["Replace ",a.length," Poster",1!==a.length?"s":""]})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"This will replace the selected posters with alternatives from external sources like TMDB"})]}),(0,t.jsx)(es.w,{}),(0,t.jsx)(er,{value:n,onValueChange:i,label:"Poster Language Preference"}),"null"===n&&(0,t.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:(0,t.jsxs)("div",{className:"text-sm text-blue-800",children:[(0,t.jsx)("strong",{children:"Textless Posters:"}),' These are special "No Language" posters from TMDB that contain no text, making them suitable for international audiences or cleaner visual aesthetics.']})}),(0,t.jsxs)(G.Fc,{children:[(0,t.jsx)(F.A,{className:"h-4 w-4"}),(0,t.jsx)(G.XL,{children:"Note"}),(0,t.jsx)(G.TN,{children:'Current posters will be backed up and the "aphrodite-overlay" tag will be removed from replaced items.'})]}),(0,t.jsxs)("div",{className:"flex space-x-3",children:[(0,t.jsxs)(w.$,{onClick:p,className:"flex-1",disabled:c,children:[(0,t.jsx)($.A,{className:"h-4 w-4 mr-2"}),"Start Replacement"]}),(0,t.jsx)(w.$,{variant:"outline",onClick:g,disabled:c,children:"Cancel"})]})]}),"processing"===u&&(0,t.jsxs)("div",{className:"space-y-6 text-center",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(x.A,{className:"h-8 w-8 animate-spin mx-auto text-blue-600"}),(0,t.jsx)("h3",{className:"text-lg font-medium",children:"Replacing Posters..."}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Processing ",a.length," item",1!==a.length?"s":"",". This may take a moment."]})]}),(0,t.jsx)(T.k,{value:66,className:"w-full"}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Searching for alternatives and updating posters..."})]}),"results"===u&&(()=>{if(!d)return null;let e=d.failed_replacements>0,s=Math.round(d.successful_replacements/d.processed_count*100);return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"text-center space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[d.successful_replacements>0?(0,t.jsx)(K.A,{className:"h-6 w-6 text-green-600"}):(0,t.jsx)(ea.A,{className:"h-6 w-6 text-red-600"}),(0,t.jsx)("h3",{className:"text-lg font-medium",children:d.successful_replacements>0?"Replacement Complete":"Replacement Failed"})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:d.message})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-green-600",children:d.successful_replacements}),(0,t.jsx)("div",{className:"text-sm text-green-700",children:"Successful"})]}),(0,t.jsxs)("div",{className:"text-center p-3 bg-red-50 rounded-lg",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-red-600",children:d.failed_replacements}),(0,t.jsx)("div",{className:"text-sm text-red-700",children:"Failed"})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-4 text-xs text-muted-foreground",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,t.jsx)(M.A,{className:"h-3 w-3"}),(0,t.jsxs)("span",{children:[d.processing_time.toFixed(1),"s"]})]}),(0,t.jsxs)("div",{children:[s,"% success rate"]})]}),e&&(0,t.jsxs)(G.Fc,{children:[(0,t.jsx)(F.A,{className:"h-4 w-4"}),(0,t.jsx)(G.XL,{children:"Some items failed"}),(0,t.jsxs)(G.TN,{children:[d.failed_replacements," item",1!==d.failed_replacements?"s":""," could not be processed. This may be due to missing metadata or unavailable poster sources."]})]}),(0,t.jsx)(w.$,{onClick:g,className:"w-full",children:"Close"})]})})()]})})},en=({selectedCount:e,selectedItems:s,allItems:a,onClearSelection:l,onRefreshItems:i,disabled:o=!1})=>{let[d,m]=(0,r.useState)(!1),[u,x]=(0,r.useState)(!1),{showJobCreated:h}=Q(),p=(0,Y.useRouter)(),g=a.filter(e=>s.has(e.id)),j=e=>{p.push(`/preview?posterId=${e.id}`)},f=()=>{m(!0)},v=()=>{x(!0)},b=async()=>{await i(),l()};return 0===e?null:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)(c.Zp,{children:[(0,t.jsx)(c.aR,{className:"pb-3",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsxs)(c.ZB,{className:"text-lg",children:[e," poster",1!==e?"s":""," selected"]}),(0,t.jsx)(n.E,{variant:"secondary",children:e})]}),(0,t.jsxs)(w.$,{variant:"outline",size:"sm",onClick:l,disabled:o,children:[(0,t.jsx)(_.A,{className:"h-4 w-4 mr-2"}),"Clear Selection"]})]})}),(0,t.jsxs)(c.Wu,{className:"space-y-4",children:[(0,t.jsx)(Z,{selectedPosters:g,onImmediateProcess:j,onBatchProcess:f}),(0,t.jsx)("div",{className:"flex items-center space-x-2",children:1===e?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(w.$,{onClick:()=>j(g[0]),disabled:o,className:"flex-1",children:[(0,t.jsx)(S.A,{className:"h-4 w-4 mr-2"}),"Generate Preview"]}),(0,t.jsxs)(w.$,{onClick:v,disabled:o,variant:"outline",children:[(0,t.jsx)($.A,{className:"h-4 w-4 mr-2"}),"Replace Poster"]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(w.$,{onClick:f,disabled:o,className:"flex-1",children:[(0,t.jsx)(A.A,{className:"h-4 w-4 mr-2"}),"Create Batch Job"]}),(0,t.jsxs)(w.$,{onClick:v,disabled:o,variant:"outline",children:[(0,t.jsx)($.A,{className:"h-4 w-4 mr-2"}),"Replace Posters"]})]})})]})]}),d&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,t.jsx)("div",{className:"max-w-2xl w-full",children:(0,t.jsx)(U,{selectedPosters:g,onJobCreated:s=>{h("Batch Job Created",e),m(!1),l()},onCancel:()=>m(!1)})})}),(0,t.jsx)(el,{open:u,onOpenChange:x,selectedItems:g,onSuccess:b})]})};function ei({totalItems:e,selectedCount:s,allSelected:a,onSelectAll:r,onSelectNone:l,onToggleSelectionMode:i,selectionMode:c}){return c?(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(p.S,{checked:a,onCheckedChange:e=>{e?r():l()},className:s>0&&!a?"data-[state=indeterminate]:bg-primary":""}),(0,t.jsx)("label",{className:"text-sm font-medium",children:"Select All"})]}),(0,t.jsxs)(n.E,{variant:"secondary",className:"text-sm",children:[s," of ",e," selected"]})]}),(0,t.jsx)(w.$,{variant:"ghost",size:"sm",onClick:i,children:"Cancel Selection"})]}):(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(n.E,{variant:"outline",className:"text-sm",children:[e," item",1!==e?"s":""," total"]}),(0,t.jsx)(w.$,{variant:"outline",size:"sm",onClick:i,children:"Select Items"})]})}let ec=(0,o.A)("chevrons-left",[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]]);var eo=a(47033),ed=a(14952);let em=(0,o.A)("chevrons-right",[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]]);function eu({currentPage:e,totalItems:s,itemsPerPage:a,onPageChange:r,onItemsPerPageChange:l,loading:n=!1}){let c=Math.ceil(s/a),o=(e-1)*a+1,d=Math.min(e*a,s);return 0===s?null:(0,t.jsxs)("div",{className:"flex items-center justify-between px-2 py-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",o," to ",d," of ",s," items"]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Show:"}),(0,t.jsxs)(i.l6,{value:a.toString(),onValueChange:e=>l(parseInt(e)),disabled:n,children:[(0,t.jsx)(i.bq,{className:"w-20",children:(0,t.jsx)(i.yv,{})}),(0,t.jsxs)(i.gC,{children:[(0,t.jsx)(i.eb,{value:"25",children:"25"}),(0,t.jsx)(i.eb,{value:"50",children:"50"}),(0,t.jsx)(i.eb,{value:"100",children:"100"}),(0,t.jsx)(i.eb,{value:"200",children:"200"})]})]}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"per page"})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsxs)("div",{className:"text-sm text-muted-foreground mr-4",children:["Page ",e," of ",c]}),(0,t.jsx)(w.$,{variant:"outline",size:"sm",onClick:()=>r(1),disabled:1===e||n,children:(0,t.jsx)(ec,{className:"h-4 w-4"})}),(0,t.jsx)(w.$,{variant:"outline",size:"sm",onClick:()=>r(e-1),disabled:1===e||n,children:(0,t.jsx)(eo.A,{className:"h-4 w-4"})}),Array.from({length:Math.min(5,c)},(s,a)=>{let l;return l=c<=5||e<=3?a+1:e>=c-2?c-4+a:e-2+a,(0,t.jsx)(w.$,{variant:l===e?"default":"outline",size:"sm",onClick:()=>r(l),disabled:n,className:"w-8",children:l},l)}),(0,t.jsx)(w.$,{variant:"outline",size:"sm",onClick:()=>r(e+1),disabled:e===c||n,children:(0,t.jsx)(ed.A,{className:"h-4 w-4"})}),(0,t.jsx)(w.$,{variant:"outline",size:"sm",onClick:()=>r(c),disabled:e===c||n,children:(0,t.jsx)(em,{className:"h-4 w-4"})})]})]})}var ex=a(96474),eh=a(5748),ep=a(13943),eg=a(64398);let ej=(0,o.A)("tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);var ef=a(4780);let ev=[{id:"audio",name:"Audio Codec",description:"DTS-HD MA, Atmos, Dolby Digital Plus, etc."},{id:"resolution",name:"Resolution",description:"4K, 1080p, HDR, Dolby Vision, etc."},{id:"review",name:"Reviews & Ratings",description:"IMDb, TMDb, Rotten Tomatoes, Metacritic"},{id:"awards",name:"Awards",description:"Oscars, Emmys, Golden Globes, etc."}];function eb({isOpen:e,onClose:s,onApply:a,isLoading:l}){let[n,i]=(0,r.useState)([]),c=e=>{i(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},o=async()=>{if(0===n.length)return void V.oR.error("Please select at least one badge type");try{await a(n),i([])}catch(e){}},d=()=>{l||(i([]),s())};return(0,t.jsx)(ee.lG,{open:e,onOpenChange:d,children:(0,t.jsxs)(ee.Cf,{className:"max-w-md",children:[(0,t.jsx)(ee.c7,{children:(0,t.jsx)(ee.L3,{children:"Select Badges to Apply"})}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Choose which badge types to apply to this poster:"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(w.$,{variant:"outline",size:"sm",onClick:()=>{i(ev.map(e=>e.id))},disabled:l,children:"Select All"}),(0,t.jsx)(w.$,{variant:"outline",size:"sm",onClick:()=>{i([])},disabled:l,children:"Select None"})]}),(0,t.jsx)(es.w,{}),(0,t.jsx)("div",{className:"space-y-3",children:ev.map(e=>(0,t.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,t.jsx)(p.S,{id:e.id,checked:n.includes(e.id),onCheckedChange:()=>c(e.id),disabled:l}),(0,t.jsxs)("div",{className:"grid gap-1.5 leading-none",children:[(0,t.jsx)(H.J,{htmlFor:e.id,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:e.name}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:e.description})]})]},e.id))}),(0,t.jsx)(es.w,{}),(0,t.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,t.jsx)(w.$,{variant:"outline",onClick:d,disabled:l,children:"Cancel"}),(0,t.jsx)(w.$,{onClick:o,disabled:l||0===n.length,children:l?"Applying...":`Apply ${n.length} Badge${1!==n.length?"s":""}`})]})]})]})})}var eN=a(31158),ey=a(30474);let ew={en:"English",de:"German",fr:"French",es:"Spanish",it:"Italian",ja:"Japanese",ko:"Korean",zh:"Chinese",pt:"Portuguese",ru:"Russian",nl:"Dutch",sv:"Swedish",da:"Danish",no:"Norwegian",fi:"Finnish",pl:"Polish",cs:"Czech",hu:"Hungarian",tr:"Turkish",ar:"Arabic",he:"Hebrew"};function ek({item:e,isOpen:s,onClose:a,onPosterReplaced:l,onRefreshGrid:c}){let[o,d]=(0,r.useState)(!1),[m,u]=(0,r.useState)(!1),[x,h]=(0,r.useState)([]),[p,g]=(0,r.useState)(null),[j,f]=(0,r.useState)(null),[v,b]=(0,r.useState)("en"),N=e=>{g(e)},y=(0,r.useMemo)(()=>{let e=new Set;x.forEach(s=>{s.language?e.add(s.language):e.add("textless")});let s=Array.from(e).filter(e=>"textless"!==e).sort((e,s)=>{if("en"===e)return -1;if("en"===s)return 1;let a=ew[e]||e.toUpperCase(),t=ew[s]||s.toUpperCase();return a.localeCompare(t)});return e.has("textless")&&s.push("textless"),s},[x]),C=(0,r.useMemo)(()=>"all"===v?x:"textless"===v?x.filter(e=>!e.language):x.filter(e=>e.language===v),[x,v]),S=async()=>{if(e&&p){u(!0);try{let s=await fetch(`/api/v1/poster-replacement/items/${e.id}/replace-poster`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({item_id:e.id,jellyfin_id:e.jellyfin_id,selected_poster:p})});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.message||`Replace failed: ${s.status}`)}let t=await s.json();if(t.success)l(e.id,t.new_poster_url),c&&c(),V.oR.success(t.message),a();else throw Error(t.message||"Failed to replace poster")}catch(e){console.error("Error replacing poster:",e),V.oR.error(`Failed to replace poster: ${e.message}`)}finally{u(!1)}}};return e?(0,t.jsx)(ee.lG,{open:s,onOpenChange:a,children:(0,t.jsxs)(ee.Cf,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[(0,t.jsx)(ee.c7,{children:(0,t.jsxs)(ee.L3,{className:"flex items-center gap-2",children:[(0,t.jsx)(k.A,{className:"h-5 w-5"}),"Replace Poster: ",e.title]})}),(0,t.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-2 text-blue-800",children:[(0,t.jsx)(k.A,{className:"h-4 w-4"}),(0,t.jsxs)("span",{className:"text-sm",children:["Searching external sources for alternative posters for ",(0,t.jsx)("strong",{children:e.title}),e.year&&` (${e.year})`]})]})}),o&&(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,t.jsx)(e_,{className:"h-8 w-8 mb-4"}),(0,t.jsx)("p",{children:"Searching external sources..."})]}),j&&(0,t.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-2 text-red-800",children:[(0,t.jsx)(_.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"text-sm",children:j})]})}),!o&&!j&&x.length>0&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(R,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"Language Filter:"})]}),(0,t.jsxs)(i.l6,{value:v,onValueChange:b,children:[(0,t.jsx)(i.bq,{className:"w-48",children:(0,t.jsx)(i.yv,{placeholder:"Filter by language"})}),(0,t.jsxs)(i.gC,{children:[(0,t.jsxs)(i.eb,{value:"all",children:["All Languages (",x.length,")"]}),y.map(e=>{let s="textless"===e?x.filter(e=>!e.language).length:x.filter(s=>s.language===e).length;if("textless"===e)return(0,t.jsxs)(i.eb,{value:e,children:["Textless (",s,")"]},e);let a=ew[e]||e.toUpperCase();return(0,t.jsxs)(i.eb,{value:e,children:[a," (",s,")"]},e)})]})]})]}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["all"===v?`Found ${x.length} alternative posters. Click to select:`:`Showing ${C.length} of ${x.length} posters. Click to select:`,0===C.length&&"all"!==v&&(0,t.jsx)("span",{className:"text-amber-600 ml-2",children:"No posters available for selected language filter."})]}),(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:C.map(e=>(0,t.jsxs)("div",{className:`cursor-pointer rounded-lg border-2 transition-all hover:shadow-lg ${p?.id===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>N(e),children:[(0,t.jsxs)("div",{className:"relative aspect-[2/3] bg-muted rounded-t-lg overflow-hidden",children:[e.thumbnail_url&&(0,t.jsx)(ey.default,{src:e.thumbnail_url,alt:`${e.source} poster`,fill:!0,className:"object-cover",onError:s=>{s.currentTarget.src=e.url}}),(0,t.jsx)("div",{className:"absolute top-2 left-2",children:(0,t.jsx)(n.E,{variant:"secondary",className:"text-xs",children:e.source.toUpperCase()})}),!e.language&&(0,t.jsx)("div",{className:"absolute top-2 left-2 mt-6",children:(0,t.jsx)(n.E,{variant:"outline",className:"text-xs bg-green-100 text-green-800 border-green-300",children:"Textless"})}),e.width&&e.height&&(0,t.jsx)("div",{className:"absolute top-2 right-2",children:(0,t.jsxs)(n.E,{variant:"outline",className:"text-xs",children:[e.width,"\xd7",e.height]})}),p?.id===e.id&&(0,t.jsx)("div",{className:"absolute inset-0 bg-blue-500 bg-opacity-20 flex items-center justify-center",children:(0,t.jsx)("div",{className:"bg-blue-500 text-white rounded-full p-2",children:(0,t.jsx)("svg",{className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})})]}),(0,t.jsx)("div",{className:"p-3 space-y-1",children:(0,t.jsxs)("div",{className:"text-xs space-y-1",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Language:"})," ",e.language?e.language.toUpperCase():"Textless"]}),e.file_size_estimate&&(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Size:"})," ",e.file_size_estimate]}),e.vote_count&&e.vote_count>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Rating:"})," ",e.vote_average?.toFixed(1)||"N/A","/10 (",e.vote_count," votes)"]})]})})]},e.id))})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t",children:[(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:p&&(0,t.jsxs)(t.Fragment,{children:["Selected: ",p.source.toUpperCase()," poster",p.width&&p.height&&` (${p.width}\xd7${p.height})`]})}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(w.$,{variant:"outline",onClick:a,disabled:m,children:"Cancel"}),(0,t.jsx)(w.$,{onClick:S,disabled:!p||m,className:"min-w-[120px]",children:m?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e_,{className:"h-4 w-4 mr-2"}),"Replacing..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eN.A,{className:"h-4 w-4 mr-2"}),"Replace Poster"]})})]})]})]})}):null}let e_=({className:e})=>(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:(0,ef.cn)("animate-spin",e),children:(0,t.jsx)("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})});function eC({item:e,isOpen:s,onClose:a,onTagUpdate:l,onPosterUpdate:i,onRefreshGrid:c}){let[o,d]=(0,r.useState)(!1),[m,u]=(0,r.useState)(!1),[x,h]=(0,r.useState)(!1),[p,f]=(0,r.useState)(!1),[b,N]=(0,r.useState)(void 0),[y,k]=(0,r.useState)(!1),[_,C]=(0,r.useState)(!1);if(!e)return null;let S=b||e.poster_url,A=async s=>{if(e)try{u(!0);let t=await fetch("add"===s?"/api/v1/poster-manager/tags/add":"/api/v1/poster-manager/tags/remove",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({item_ids:[e.id]})});if(!t.ok)throw Error(`Failed to ${s} tag`);let r=await t.json();if(r.success)l(e.id,"add"===s),V.oR.success(`Tag ${"add"===s?"added":"removed"} successfully`),a();else throw Error(r.message||`Failed to ${s} tag`)}catch(e){console.error(`Error ${s}ing tag:`,e),V.oR.error(`Failed to ${s} tag`)}finally{u(!1)}},P=async()=>{if(e)try{f(!0);let s=await fetch("/api/v1/poster-manager/restore-original",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({item_id:e.id,jellyfin_id:e.jellyfin_id})});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.message||`Failed to restore original: ${s.status}`)}let t=await s.json();if(t.success){let s=Date.now(),r=e.poster_url?`${e.poster_url}?restored=${s}`:`/api/v1/images/proxy/image/${e.jellyfin_id}/thumbnail?restored=${s}`;N(r),d(!1),l(e.id,!1),i(e.id,r),c&&c(),a(),V.oR.success(t.message)}else throw Error(t.message||"Failed to restore original poster")}catch(e){console.error("Error restoring original poster:",e),V.oR.error(`Failed to restore original: ${e.message}`)}finally{f(!1)}},R=async s=>{if(e)try{h(!0);let t=await fetch("/api/v1/poster-manager/apply-badges",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({item_id:e.id,jellyfin_id:e.jellyfin_id,badge_types:s})});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.message||`Failed to apply badges: ${t.status}`)}let r=await t.json();if(r.success){let s=Date.now(),t=`/api/v1/images/proxy/image/${e.jellyfin_id}/thumbnail?badged=${s}`;N(t),d(!1),l(e.id,!0),i(e.id,t),c&&c(),k(!1),a(),V.oR.success(`Badges applied successfully! (${r.applied_badges?.join(", ")||"Unknown badges"})`)}else throw Error(r.message||"Failed to apply badges")}catch(e){console.error("Error applying badges:",e),V.oR.error(`Failed to apply badges: ${e.message}`)}finally{h(!1)}};return(0,t.jsx)(ee.lG,{open:s,onOpenChange:a,children:(0,t.jsxs)(ee.Cf,{className:"max-w-7xl max-h-[95vh] overflow-y-auto",children:[(0,t.jsx)(ee.c7,{children:(0,t.jsx)(ee.L3,{className:"text-xl font-semibold",children:e.title})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"relative aspect-[2/3] bg-muted rounded-lg overflow-hidden",children:[(x||p)&&(0,t.jsx)("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center z-10",children:(0,t.jsxs)("div",{className:"bg-background border rounded-lg p-4 flex flex-col items-center gap-2 shadow-lg",children:[(0,t.jsx)(e_,{className:"h-8 w-8 text-foreground"}),(0,t.jsx)("span",{className:"text-sm font-medium text-foreground",children:x?"Applying badges...":"Restoring original..."})]})}),S&&!o?(0,t.jsx)("img",{src:v(S),alt:e.title,className:"w-full h-full object-cover",onError:()=>d(!0)},S):(0,t.jsx)("div",{className:"flex items-center justify-center h-full bg-muted",children:(0,t.jsx)(g,{className:"h-16 w-16 text-muted-foreground"})}),(0,t.jsx)("div",{className:"absolute top-4 left-4",children:(0,t.jsx)(n.E,{variant:"BADGED"===e.badge_status?"destructive":"secondary",className:"text-sm",children:e.badge_status})})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-2",children:[(0,t.jsxs)(w.$,{onClick:()=>k(!0),disabled:x||p,className:"w-full",children:[(0,t.jsx)($.A,{className:"h-4 w-4 mr-2"}),"Apply Badges"]}),"ORIGINAL"===e.badge_status?(0,t.jsxs)(w.$,{onClick:()=>A("add"),disabled:m||x||p,variant:"outline",className:"w-full",children:[(0,t.jsx)(ex.A,{className:"h-4 w-4 mr-2"}),"Add Aphrodite Tag"]}):(0,t.jsxs)(w.$,{onClick:()=>A("remove"),disabled:m||x||p,variant:"outline",className:"w-full",children:[(0,t.jsx)(eh.A,{className:"h-4 w-4 mr-2"}),"Remove Aphrodite Tag"]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-2",children:[(0,t.jsxs)(w.$,{onClick:()=>{C(!0)},disabled:x||p,variant:"outline",className:"w-full",children:[(0,t.jsx)($.A,{className:"h-4 w-4 mr-2"}),"Replace Poster"]}),(0,t.jsxs)(w.$,{onClick:P,disabled:x||p,variant:"outline",className:"w-full",children:[(0,t.jsx)(ep.A,{className:"h-4 w-4 mr-2"}),"Restore to Original"]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,t.jsx)(j.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:e.year||"Unknown Year"}),(0,t.jsx)(es.w,{orientation:"vertical",className:"h-4"}),(0,t.jsx)(n.E,{variant:"outline",className:"capitalize",children:e.type})]}),(e.community_rating||e.official_rating)&&(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[e.community_rating&&(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(eg.A,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"}),(0,t.jsx)("span",{className:"text-sm font-medium",children:e.community_rating.toFixed(1)})]}),e.official_rating&&(0,t.jsx)(n.E,{variant:"secondary",className:"text-xs",children:e.official_rating})]})]}),(0,t.jsx)(es.w,{}),e.genres.length>0&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("h4",{className:"text-sm font-medium flex items-center gap-2",children:[(0,t.jsx)(ej,{className:"h-4 w-4"}),"Genres"]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:e.genres.map(e=>(0,t.jsx)(n.E,{variant:"outline",className:"text-xs",children:e},e))})]}),(0,t.jsx)(es.w,{}),e.overview&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h4",{className:"text-sm font-medium",children:"Overview"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground leading-relaxed",children:e.overview})]}),(0,t.jsx)(es.w,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h4",{className:"text-sm font-medium",children:"Technical Details"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs text-muted-foreground",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium",children:"Jellyfin ID:"}),(0,t.jsx)("br",{}),(0,t.jsx)("span",{className:"font-mono break-all",children:e.jellyfin_id})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium",children:"Internal ID:"}),(0,t.jsx)("br",{}),(0,t.jsx)("span",{className:"font-mono break-all",children:e.id})]})]})]})]})]}),(0,t.jsx)(eb,{isOpen:y,onClose:()=>k(!1),onApply:R,isLoading:x}),(0,t.jsx)(ek,{item:e,isOpen:_,onClose:()=>C(!1),onPosterReplaced:(e,s)=>{N(s),d(!1),i(e,s),c&&c()},onRefreshGrid:c})]})})}let eS=(0,o.A)("images",[["path",{d:"M18 22H4a2 2 0 0 1-2-2V6",key:"pblm9e"}],["path",{d:"m22 13-1.296-1.296a2.41 2.41 0 0 0-3.408 0L11 18",key:"nf6bnh"}],["circle",{cx:"12",cy:"8",r:"2",key:"1822b1"}],["rect",{width:"16",height:"16",x:"6",y:"2",rx:"2",key:"12espp"}]]),e$=(0,o.A)("briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);var eA=a(64298);let eP=()=>"";function eR(){let[e,s]=(0,r.useState)("library"),[a,i]=(0,r.useState)(0),[o,d]=(0,r.useState)([]),[m,u]=(0,r.useState)(""),[p,g]=(0,r.useState)([]),[j,f]=(0,r.useState)(null),[v,b]=(0,r.useState)(!1),[y,k]=(0,r.useState)(!1),[_,S]=(0,r.useState)(""),[$,A]=(0,r.useState)("all"),[R,E]=(0,r.useState)(1),[T,F]=(0,r.useState)(50),[M,D]=(0,r.useState)(0),[L,z]=(0,r.useState)(!1),[J,I]=(0,r.useState)(new Set),[B,O]=(0,r.useState)(!1),[q,G]=(0,r.useState)(null),[Z,H]=(0,r.useState)(!1),U=async a=>{if(s(a),"jobs"===e&&"library"===a&&m){V.oR.info("Refreshing library to show latest badge status..."),k(!0);try{_||"all"!==$?await ee(R):await Q(R);let e=Date.now();g(s=>s.map(s=>{if(s.poster_url){let a=s.poster_url.includes("?")?`${s.poster_url}&refresh=${e}`:`${s.poster_url}?refresh=${e}`;return{...s,poster_url:a}}return s})),V.oR.success("Library refreshed successfully")}catch(e){console.error("Error refreshing library:",e),V.oR.error("Failed to refresh library")}finally{k(!1)}}},K=async()=>{try{let e=await eA.apiService.getJobs({user_id:"default_user"}),s=e.jobs?.filter(e=>["processing","paused","queued"].includes(e.status))||[];i(s.length)}catch(e){console.log("Could not load job count:",e)}},X=async()=>{try{b(!0);let e=await fetch(`${eP()}/api/v1/poster-manager/libraries`);if(!e.ok)throw Error(`HTTP ${e.status}: ${e.statusText}`);let s=await e.json();d(s.libraries||[]),s.libraries&&s.libraries.length>0&&u(s.libraries[0].id)}catch(e){console.error("Error loading libraries:",e),V.oR.error("Failed to load Jellyfin libraries. Please check your connection.")}finally{b(!1)}},Q=async(e=1)=>{if(m)try{b(!0);let s=(e-1)*T,a=await fetch(`${eP()}/api/v1/poster-manager/libraries/${m}/items?limit=${T}&offset=${s}`);if(!a.ok)throw Error(`HTTP ${a.status}: ${a.statusText}`);let t=await a.json();g(t.items||[]),D(t.total_count||0),z(t.has_more||!1),E(e)}catch(e){console.error("Error loading library items:",e),V.oR.error("Failed to load library items")}finally{b(!1)}},Y=async()=>{if(m)try{let e=await fetch(`${eP()}/api/v1/poster-manager/libraries/${m}/stats`);if(!e.ok)throw Error(`HTTP ${e.status}: ${e.statusText}`);let s=await e.json();f(s)}catch(e){console.error("Error loading library stats:",e)}},ee=async(e=1)=>{if(m)try{b(!0);let s=(e-1)*T,a=new URLSearchParams({library_id:m,limit:T.toString(),offset:s.toString()});_.trim()&&a.append("query",_.trim()),"all"!==$&&a.append("badge_filter",$);let t=await fetch(`${eP()}/api/v1/poster-manager/search?${a}`);if(!t.ok)throw Error(`HTTP ${t.status}: ${t.statusText}`);let r=await t.json();g(r.items||[]),D(r.total_count||0),z(r.has_more||!1),E(e)}catch(e){console.error("Error searching items:",e),V.oR.error("Failed to search items")}finally{b(!1)}},es=async()=>{k(!0),await X(),m&&(await Q(),await Y()),await K();let e=Date.now();g(s=>s.map(s=>{if(s.poster_url){let a=s.poster_url.includes("?")?`${s.poster_url}&refresh=${e}`:`${s.poster_url}?refresh=${e}`;return{...s,poster_url:a}}return s})),k(!1),V.oR.success("Library refreshed successfully")},ea=()=>{I(new Set)},et=async()=>{m&&(_||"all"!==$?await ee(R):await Q(R)),I(new Set),await K()},er=e=>{_||"all"!==$?ee(e):Q(e),I(new Set),O(!1)},el=e=>{F(e),E(1),_||"all"!==$?ee(1):Q(1),I(new Set),O(!1)},ec=p.length>0&&J.size===p.length;return(0,t.jsxs)("div",{className:"container mx-auto p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Poster Manager"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Browse, manage, and process your Jellyfin library posters"})]}),(0,t.jsxs)(w.$,{onClick:es,disabled:y,variant:"outline",children:[y?(0,t.jsx)(x.A,{className:"h-4 w-4 animate-spin mr-2"}):(0,t.jsx)(P.A,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),(0,t.jsxs)(l.tU,{value:e,onValueChange:U,children:[(0,t.jsxs)(l.j7,{className:"grid w-full grid-cols-2",children:[(0,t.jsxs)(l.Xi,{value:"library",className:"flex items-center",children:[(0,t.jsx)(eS,{className:"h-4 w-4 mr-2"}),"Library"]}),(0,t.jsxs)(l.Xi,{value:"jobs",className:"flex items-center",children:[(0,t.jsx)(e$,{className:"h-4 w-4 mr-2"}),"Jobs",a>0&&(0,t.jsx)(n.E,{variant:"secondary",className:"ml-2",children:a})]})]}),(0,t.jsxs)(l.av,{value:"library",className:"space-y-6",children:[(0,t.jsx)(h,{libraries:o,selectedLibrary:m,onLibraryChange:u,loading:v}),j&&(0,t.jsxs)(c.Zp,{children:[(0,t.jsxs)(c.aR,{children:[(0,t.jsx)(c.ZB,{children:"Library Overview"}),(0,t.jsx)(c.BT,{children:"Statistics for the selected library"})]}),(0,t.jsx)(c.Wu,{children:(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:j.total_items}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Total Items"})]}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:j.movies}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Movies"})]}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:j.tv_shows}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"TV Shows"})]}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:j.genres.length}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Genres"})]})]})})]}),m&&(0,t.jsx)(C,{searchQuery:_,onSearchChange:S,badgeFilter:$,onBadgeFilterChange:A,onClearFilters:()=>{S(""),A("all")}}),m&&p.length>0&&(0,t.jsx)(ei,{totalItems:p.length,selectedCount:J.size,allSelected:ec,onSelectAll:()=>{I(new Set(p.map(e=>e.id)))},onSelectNone:ea,onToggleSelectionMode:()=>{O(!B),B&&I(new Set)},selectionMode:B}),(0,t.jsx)(en,{selectedCount:J.size,selectedItems:J,allItems:p,onClearSelection:ea,onRefreshItems:et,disabled:v}),m&&(0,t.jsxs)(t.Fragment,{children:[M>0&&(0,t.jsx)(eu,{currentPage:R,totalItems:M,itemsPerPage:T,onPageChange:er,onItemsPerPageChange:el,loading:v}),(0,t.jsx)(N,{items:p,loading:v,selectedItems:J,onSelectionChange:(e,s)=>{I(a=>{let t=new Set(a);return s?t.add(e):t.delete(e),t})},selectionMode:B,onPosterClick:e=>{G(e),H(!0)}}),M>0&&(0,t.jsx)(eu,{currentPage:R,totalItems:M,itemsPerPage:T,onPageChange:er,onItemsPerPageChange:el,loading:v})]}),!m&&!v&&(0,t.jsx)(c.Zp,{children:(0,t.jsx)(c.Wu,{className:"flex flex-col items-center justify-center py-10",children:(0,t.jsx)("p",{className:"text-muted-foreground text-center",children:"Select a library to view your media posters"})})})]}),(0,t.jsx)(l.av,{value:"jobs",children:(0,t.jsx)(W,{})})]}),(0,t.jsx)(eC,{item:q,isOpen:Z,onClose:()=>{H(!1),G(null)},onTagUpdate:(e,s)=>{g(a=>a.map(a=>{if(a.id===e){if(!s&&a.poster_url){let e=Date.now(),s=a.poster_url.includes("?")?`${a.poster_url}&refresh=${e}`:`${a.poster_url}?refresh=${e}`;return{...a,badge_status:"ORIGINAL",poster_url:s}}return{...a,badge_status:s?"BADGED":"ORIGINAL"}}return a}))},onPosterUpdate:(e,s)=>{let a=s.includes("?restored="),t=s.includes("?badged=");g(r=>r.map(r=>{if(r.id===e){let e=Date.now(),l=s.includes("?")?`${s}&t=${e}`:`${s}?t=${e}`;return{...r,poster_url:l,badge_status:a?"ORIGINAL":t?"BADGED":r.badge_status}}return r}))},onRefreshGrid:et})]})}},52239:(e,s,a)=>{Promise.resolve().then(a.bind(a,49993))},54300:(e,s,a)=>{"use strict";a.d(s,{J:()=>c});var t=a(60687),r=a(43210),l=a(14163),n=r.forwardRef((e,s)=>(0,t.jsx)(l.sG.label,{...e,ref:s,onMouseDown:s=>{s.target.closest("button, input, select, textarea")||(e.onMouseDown?.(s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));n.displayName="Label";var i=a(4780);function c({className:e,...s}){return(0,t.jsx)(n,{"data-slot":"label",className:(0,i.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",e),...s})}},56896:(e,s,a)=>{"use strict";a.d(s,{S:()=>i});var t=a(60687);a(43210);var r=a(40211),l=a(13964),n=a(4780);function i({className:e,...s}){return(0,t.jsx)(r.bL,{"data-slot":"checkbox",className:(0,n.cn)("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",e),...s,children:(0,t.jsx)(r.C1,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:(0,t.jsx)(l.A,{className:"size-3.5"})})})}},62140:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(62688).A)("file-image",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]])},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},64398:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(62688).A)("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]])},79551:e=>{"use strict";e.exports=require("url")},91821:(e,s,a)=>{"use strict";a.d(s,{Fc:()=>i,TN:()=>o,XL:()=>c});var t=a(60687);a(43210);var r=a(24224),l=a(4780);let n=(0,r.F)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function i({className:e,variant:s,...a}){return(0,t.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,l.cn)(n({variant:s}),e),...a})}function c({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"alert-title",className:(0,l.cn)("col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",e),...s})}function o({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"alert-description",className:(0,l.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",e),...s})}},96474:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(62688).A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},97840:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(62688).A)("play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]])},99095:(e,s,a)=>{Promise.resolve().then(a.bind(a,48028))}};var s=require("../../webpack-runtime.js");s.C(e);var a=e=>s(s.s=e),t=s.X(0,[447,264,658,77,269,343,891,36],()=>a(39759));module.exports=t})();