# Aphrodite v2 Schedules Feature\n\nThis document describes the new Schedules feature in Aphrodite v2, which allows automated poster processing based on cron expressions.\n\n## Overview\n\nThe Schedules feature provides:\n- **Automated Processing**: Run poster enhancement on a schedule\n- **Flexible Timing**: Use cron expressions or quick presets\n- **Selective Processing**: Choose specific badge types and libraries\n- **Execution History**: Track all schedule runs and their results\n- **Easy Management**: Web-based interface for creating and managing schedules\n\n## Database Setup\n\nBefore using the Schedules feature, you need to create the necessary database tables:\n\n```bash\ncd aphrodite-v2/migration-tools\npython create_schedules_tables.py\n```\n\nThis will create two tables:\n- `schedules`: Stores schedule configurations\n- `schedule_executions`: Tracks execution history\n\n## API Testing\n\nTo verify the API endpoints are working correctly:\n\n```bash\ncd aphrodite-v2/migration-tools\npython test_schedules_api.py\n```\n\nThis test script will:\n1. Test configuration endpoints\n2. Create a test schedule\n3. Update and delete the schedule\n4. Verify all CRUD operations work\n\n## Frontend Interface\n\nThe Schedules page is accessible at `/schedules` and provides three tabs:\n\n### 1. Schedules Tab\n- View all existing schedules\n- Create new schedules\n- Edit existing schedules\n- Enable/disable schedules\n- Manually execute schedules\n- Delete schedules\n\n### 2. History Tab\n- View execution history\n- Filter by status (pending, running, completed, failed)\n- See execution details and duration\n- View error messages for failed executions\n\n### 3. Editor Tab\n- Create or edit schedule configurations\n- Set schedule name and timezone\n- Choose from quick presets or custom cron expressions\n- Select badge types to apply\n- Choose target libraries\n- Configure reprocessing options\n\n## Schedule Configuration Options\n\n### Basic Information\n- **Schedule Name**: Descriptive name for the schedule\n- **Timezone**: Timezone for cron expression evaluation\n- **Cron Expression**: When to run the schedule\n\n### Quick Presets\n- Every Hour: `0 * * * *`\n- Daily at 2:00 AM: `0 2 * * *`\n- Weekly (Sunday 2:00 AM): `0 2 * * 0`\n- Monthly (1st day 2:00 AM): `0 2 1 * *`\n- Every 6 Hours: `0 */6 * * *`\n- Weekdays at 2:00 AM: `0 2 * * 1-5`\n- Weekends at 2:00 AM: `0 2 * * 6,0`\n- Twice Daily: `0 2,14 * * *`\n\n### Processing Options\n- **Badge Types**: Select which badge types to apply (resolution, audio, review, awards)\n- **Reprocess All**: Whether to process items that already have badges\n- **Target Libraries**: Specific Jellyfin libraries to process (empty = all libraries)\n\n### Schedule Control\n- **Enabled**: Whether the schedule should run automatically\n- **Manual Execution**: Run a schedule immediately regardless of its cron expression\n\n## API Endpoints\n\n### Schedule Management\n- `GET /api/v1/schedules` - List all schedules\n- `POST /api/v1/schedules` - Create a new schedule\n- `GET /api/v1/schedules/{id}` - Get specific schedule\n- `PUT /api/v1/schedules/{id}` - Update schedule\n- `DELETE /api/v1/schedules/{id}` - Delete schedule\n- `POST /api/v1/schedules/{id}/execute` - Manually execute schedule\n\n### Execution History\n- `GET /api/v1/schedules/executions/history` - Get execution history\n\n### Configuration\n- `GET /api/v1/schedules/config/badge-types` - Available badge types\n- `GET /api/v1/schedules/config/cron-presets` - Cron presets\n- `GET /api/v1/schedules/config/libraries` - Available Jellyfin libraries\n\n## Database Schema\n\n### schedules table\n```sql\nid UUID PRIMARY KEY\nname VARCHAR(255) NOT NULL\ntimezone VARCHAR(100) NOT NULL DEFAULT 'UTC'\ncron_expression VARCHAR(100) NOT NULL\nbadge_types TEXT[] NOT NULL DEFAULT '{}'\nreprocess_all BOOLEAN NOT NULL DEFAULT false\nenabled BOOLEAN NOT NULL DEFAULT true\ntarget_libraries TEXT[] NOT NULL DEFAULT '{}'\ncreated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\nupdated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n```\n\n### schedule_executions table\n```sql\nid UUID PRIMARY KEY\nschedule_id UUID NOT NULL\nstatus VARCHAR(50) NOT NULL\nstarted_at TIMESTAMP WITH TIME ZONE\ncompleted_at TIMESTAMP WITH TIME ZONE\nerror_message TEXT\nitems_processed TEXT\ncreated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n```\n\n## Implementation Status\n\n‚úÖ **Completed:**\n- Database models and migrations\n- Complete API endpoints\n- Frontend React components\n- API integration\n- Cron expression presets\n- Jellyfin library integration\n- Badge type configuration\n- Schedule CRUD operations\n- Execution history tracking\n\nüöß **To Be Implemented:**\n- Actual cron job scheduler integration\n- Background job processing for schedule execution\n- Real-time status updates via WebSocket\n- Email notifications for failed executions\n- Advanced cron expression validation\n\n## Usage Examples\n\n### Creating a Daily Schedule\n1. Go to Schedules page\n2. Click \"Create Schedule\"\n3. Enter name: \"Daily Badge Processing\"\n4. Select timezone: \"America/New_York\"\n5. Choose preset: \"Daily at 2:00 AM\"\n6. Select badge types: \"resolution\", \"audio\", \"review\"\n7. Leave libraries empty to process all\n8. Enable the schedule\n9. Click \"Create Schedule\"\n\n### Manual Execution\n1. Go to Schedules tab\n2. Find your schedule\n3. Click the play button (‚ñ∂Ô∏è)\n4. Check History tab to see execution progress\n\n## Troubleshooting\n\n### Database Connection Issues\n- Ensure PostgreSQL is running\n- Check database credentials in settings\n- Run the migration script to create tables\n\n### Jellyfin Integration Issues\n- Verify Jellyfin connection in Settings\n- Check API key and user ID configuration\n- Libraries endpoint will fail if Jellyfin is not properly configured\n\n### Schedule Not Running\n- Check that the schedule is enabled\n- Verify the cron expression is valid\n- Check the execution history for error messages\n\nThis completes the basic Schedules feature implementation for Aphrodite v2!\n